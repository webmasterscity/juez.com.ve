!function(a){a.chat=function(){function addHover(t,o){t.each(function(t,e){a(e).hover(function(){a(this).addClass(o)},function(){a(this).removeClass(o)})})}function preventScrolling(t){t.bind("mousewheel DOMMouseScroll",function(t){var a=t.originalEvent,o=a.wheelDelta||-a.detail;this.scrollTop+=30*(0>o?1:-1),t.preventDefault()})}function showLoading(t){a(".chat_hide_loading",t).hide(),a(".chat_show_loading",t).show()}function hideLoading(t){a(".chat_hide_loading",t).show(),a(".chat_show_loading",t).hide()}function closePopup(t,a,o){void 0!==t&&(1==o?t.addClass("chat_tabopen_hidden"):t.removeClass("chat_tabopen")),void 0!==a&&a.removeClass("chat_tabclick chat_userstabclick chat_trayclick chat_usertabclick")}function hideTooltip(){$tooltip&&$tooltip.hide()}function showTooltip(t,o,e,s,c,_){null===$tooltip&&($tooltip=a('<div id="chat_tooltip"><div class="chat_tooltip_content"></div></div>').appendTo($body),$tooltip_content=a(".chat_tooltip_content",$tooltip)),$tooltip_content.html(o);var i=t.offset(),n=t.width(),h=t.height(),r=$tooltip.width();s||(s=0),c||(c=0),e?$tooltip.css({top:i.top-a(window).scrollTop()-h-5-c,left:i.left+n-16-s,display:"block"}).addClass("chat_tooltip_left"):_?$tooltip.css({top:i.top-a(window).scrollTop()-h-5-c,left:i.left+n-r+18-s,display:"block","background-position":r-128+"px -58px"}).removeClass("chat_tooltip_left"):$tooltip.css({top:i.top-a(window).scrollTop()-h-5-c,left:i.left+n-r+18-s,display:"block","background-position":r-23+"px -114px"}).removeClass("chat_tooltip_left"),W&&($tooltip.css("position","absolute"),$tooltip.css("top",parseInt(a(window).height())-parseInt($tooltip.css("bottom"))-parseInt($tooltip.height())+a(window).scrollTop()+"px"))}function replaceURLWithHTMLLinks(t){return t.replace(exp,"<a href='$1' target='_blank'>$1</a>")}function smileyreplace(t){if(1!=c_disable_smilies)for(i=0;i<Smiley.length;i++){var a=Smiley[i][1].replace(/</g,"&lt;").replace(/>/g,"&gt;"),o=t.lastIndexOf(a);-1!=o&&(t=t.replace(new RegExp(RegExp.escape(a),"g"),'<img class="chat_smiley" src="'+c_ac_path+"themes/"+u_theme+"/images/smilies/"+Smiley[i][0]+'.png" alt="" />'))}return t}function chatroomKeydown(t,o){if(13==t.keyCode&&0==t.shiftKey){var e=o.val();return e=e.replace(/^\s+|\s+$/g,""),o.val(""),o.css("height","18px"),o.css("overflow-y","hidden"),o.focus(),1==c_send_room_msg&&""!=e?displayMessage("chat_chatroom_message_flyout",lang[209],"error"):""!=e&&a.ajax({url:c_ac_path+"includes/json/send/send_message_chatroom.php",type:"post",cache:!1,dataType:"json",data:{userid:u_id,username:u_name,chatroomid:Ccr,message:e},beforeSend:function(){a(".chat_chatroom_message_input").addClass("chat_message_sending")},error:function(){a(".chat_chatroom_message_input").removeClass("chat_message_sending"),displayMessage("chat_chatroom_message_flyout",lang[135],"error")},success:function(t){if(a(".chat_chatroom_message_input").removeClass("chat_message_sending"),t){var o=!0;t&&a.each(t,function(t,e){"error"==t&&a.each(e,function(t,a){o=!1,displayMessage("chat_chatroom_message_flyout",a.m,"error")})}),o&&(addMessageToChatroom(t,u_name,e),$chatroom_chat.scrollTop($chatroom_chat[0].scrollHeight))}}}),!1}}function userchatKeydown(t,o,e,s){if(1!=s&&(clearTimeout(pa),pa=setTimeout(function(){a.post(c_ac_path+"includes/json/send/send_typing.php",{userid:u_id,typing:e,untype:1},function(){}),fa=-1},5e3),fa!=e&&(a.post(c_ac_path+"includes/json/send/send_typing.php",{userid:u_id,typing:e},function(){}),fa=e)),13==t.keyCode&&0==t.shiftKey){var c=o.val();return c=c.replace(/^\s+|\s+$/g,""),o.val("").css({height:"18px","overflow-y":"hidden"}).focus(),1==c_send_priv_msg&&""!=c?displayMessage("chat_chatbox_message_flyout_"+e,lang[209],"error"):""!=c&&a.ajax({url:c_ac_path+"includes/json/send/send_message.php",type:"post",cache:!1,dataType:"json",data:{userid:u_id,to:e,message:c},beforeSend:function(){a(".chat_textarea").addClass("chat_message_sending")},error:function(){a(".chat_textarea").removeClass("chat_message_sending"),displayMessage("chat_chatbox_message_flyout_"+e,lang[135],"error")},success:function(t){a(".chat_textarea").removeClass("chat_message_sending"),t&&("-1"==t?displayMessage("chat_chatbox_message_flyout_"+e,lang[102],"error"):addMessageToChatbox(e,c,"1","1",t,1,Math.floor((new Date).getTime()/1e3))),K=1}}),!1}}function resizeChatfield(t){var a=t[0].clientHeight;94>a?(a=Math.max(t[0].scrollHeight,a),a=Math.min(94,a),a>t[0].clientHeight&&t.css("height",a+4+"px")):t.css("overflow-y","auto")}function chatroomKeyup(t,a){resizeChatfield(a),$chatroom_chat.scrollTop($chatroom_chat[0].scrollHeight)}function userchatKeyup(t,o,e){resizeChatfield(o),a(".chat_tabcontenttext",$user_popups[e]).scrollTop(a(".chat_tabcontenttext",$user_popups[e])[0].scrollHeight)}function clearUserStatus(){a("#chat_userstab_icon").removeClass("chat_user_available2 chat_user_busy2 chat_user_invisible2 chat_user_away2")}function setUserStatus(t){a("#chat_userstab_icon").removeClass("chat_user_available2 chat_user_busy2 chat_user_invisible2"),a.post(c_ac_path+"includes/json/send/send_status.php",{userid:u_id,status:t},function(){})}function showUserOffline(){w=1,clearUserStatus(),a("#chat_userstab_icon").addClass("chat_user_invisible2"),setUserStatus("offline"),closePopup($userstab_popup,$buddy_list_tab),closePopup($optionsbutton_popup,$optionsbutton),closePopup($modbutton_popup,$modbutton),a("#chat_userstab_text").html(lang[7])}function buildMaintenance(){$maintenance=a(chat.Templates.maintenance_tab(c_login_url)).appendTo($base),$maintenance.mouseover(function(){"1"==c_guests_login_msg&&""==u_id?showTooltip($maintenance,lang[58]):showTooltip($maintenance,lang[27]),a(this).addClass("chat_tabmouseover")}),$maintenance.mouseout(function(){a(this).removeClass("chat_tabmouseover"),hideTooltip()})}function buildHideBarButton(){$hide_bar_button=a(chat.Templates.bar_hide_tab()).appendTo($base),$hide_bar_button.mouseover(function(){showTooltip($hide_bar_button,lang[14]),a(this).addClass("chat_tabmouseover")}),$hide_bar_button.mouseout(function(){a(this).removeClass("chat_tabmouseover"),hideTooltip()}),$hide_bar_button.click(function(){lsClick("#chat_hide_bar_button","ac_click"),a.post(c_ac_path+"includes/json/send/send_settings.php",{hide:"1"}),showUserOffline(),closePopup($chatrooms_popup,$chatrooms_button),closePopup($applications_button_popup,$applications_button),""!=m&&(closePopup($application_button_popups[m],$application_buttons[m]),m=""),""!=j&&(closePopup($user_popups[j],$users[j]),a(".chat_closebox_bottom",$users[j]).removeClass("chat_closebox_bottom_click"),j=""),clearTimeout(Z),clearTimeout(Crref2),a.idleTimer("destroy"),pushCancelAll(),cancelJSONP(),$base.hide(),$show_bar_button.show()})}function buildShowBarButton(){$show_bar_button=a(chat.Templates.bar_show_tab()).appendTo($body),$show_bar_button.mouseover(function(){showTooltip($show_bar_button,lang[15]),a(this).addClass("chat_tabmouseover")}),$show_bar_button.mouseout(function(){a(this).removeClass("chat_tabmouseover"),hideTooltip()}),$show_bar_button.click(function(){showBar()})}function showBar(){lsClick("#chat_show_bar_button","ac_click"),a.post(c_ac_path+"includes/json/send/send_settings.php",{hide:"-1"}),setUserStatus("available"),a("#chat_userstab_icon").addClass("chat_user_available2"),w=0,loadBuddyList(),pushSubscribe(),receiveCore(),a.idleTimer(6e4*chat.IdleTime),$show_bar_button.hide(),$base.show()}function startCreateChatRoom(){var t=a("#chat_chatroom_create_input").val(),o=a("#chat_chatroom_create_password_input").val();a("#chat_chatroom_create_input").val(""),a("#chat_chatroom_create_password_input").val(""),t=t.replace(/^\s+|\s+$/g,""),""!=t&&a.post(c_ac_path+"includes/json/send/send_chatroom_create.php",{userid:u_id,name:t,password:o},function(t){t&&($chatroom_create_flyout.hide("slide",{direction:"up"},250),a("#chat_chatroom_options_flyout").removeClass("chat_chatroom_options_flyout_display"),"-1"==t?displayMessage("chat_chatroom_message_flyout",lang[39],"error"):"-2"==t?displayMessage("chat_chatroom_message_flyout",lang[40],"error"):(chatroomreceived=0,loadChatroomList()))})}function buildChatroomsButton(){function t(){a("#chat_chatroom_options_flyout").removeClass("chat_chatroom_options_flyout_display")}function o(){$chatroom_create_flyout.is(":visible")&&$chatroom_create_flyout.hide("slide",{direction:"up"},250)}$chatrooms_button=a(chat.Templates.chatrooms_tab()).appendTo($base),$chatrooms_popup=a(chat.Templates.chatrooms_window()).css("display","none").appendTo($body),$chatroom_create=a("#chat_chatroom_create"),$chatroom_create_flyout=a("#chat_chatroom_create_flyout"),$chatrooms_button.css("width",c_width_chatroom+"px"),a("#chat_chatroom_create_input").placeholder(),a("#chat_chatroom_create_password_input").placeholder(),c_width_chatroom<=25&&a("#chat_chatrooms_text",$chatrooms_button).hide(),1==u_chatroom_block_chats?a("#chat_chatroom_block :input").prop("checked",!0):(a("#chat_chatroom_block").addClass("chat_menu_unchecked"),a("#chat_chatroom_block :input").prop("checked",!1)),1==u_chatroom_sound?a("#chat_chatroom_sound :input").prop("checked",!0):(a("#chat_chatroom_sound").addClass("chat_menu_unchecked"),a("#chat_chatroom_sound :input").prop("checked",!1)),1==u_chatroom_show_names?a("#chat_chatroom_show_names :input").prop("checked",!0):(a("#chat_chatroom_show_names").addClass("chat_menu_unchecked"),a("#chat_chatroom_show_names :input").prop("checked",!1)),"-1"!=u_chatroom_stay?a("#chat_chatroom_stay :input").prop("checked",!0):(a("#chat_chatroom_stay").addClass("chat_menu_unchecked"),a("#chat_chatroom_stay :input").prop("checked",!1)),"-1"!=u_chatroom_open?a("#chat_chatroom_window :input").prop("checked",!0):(a("#chat_chatroom_window").addClass("chat_menu_unchecked"),a("#chat_chatroom_window :input").prop("checked",!1)),"0"==c_user_chatrooms&&$chatroom_create.hide(),$chatrooms_button.click(function(){lsClick("#chat_chatrooms_button","ac_openclose"),count=0,c_width_chatroom<=25&&hideTooltip(),a(".chat_tabalert",$chatrooms_button).length>0&&(a(".chat_tabalert",$chatrooms_button).remove(),$chatrooms_button.removeClass("chat_tab_new_message")),loadChatroomList(),closePopup($userstab_popup,$buddy_list_tab),closePopup($optionsbutton_popup,$optionsbutton),closePopup($modbutton_popup,$modbutton),$chatrooms_popup.css("left",$chatrooms_button.offset().left-$chatrooms_popup.outerWidth()+$chatrooms_button.outerWidth()).css("bottom","25px"),a(this).toggleClass("chat_tabclick").toggleClass("chat_userstabclick"),$chatrooms_popup.toggleClass("chat_tabopen"),void 0!==$chatroom_chat&&$chatroom_chat.scrollTop(5e4),a(".chat_chatroom_message_input").focus()}),$chatrooms_button.mouseover(function(){c_width_chatroom<=25&&($chatrooms_button.hasClass("chat_tabclick")||showTooltip($chatrooms_button,lang[19])),a(this).addClass("chat_tabmouseover")}),$chatrooms_button.mouseout(function(){a(this).removeClass("chat_tabmouseover"),hideTooltip()}),preventScrolling(a(".chat_chatroom_content")),a("#chat_chatroom_password_input").keydown(function(t){13==t.keyCode&&(c=a("#chat_chatroom_password_id").val(),a("#chat_chatroom_password_flyout").hide(),input_value=a("#chat_chatroom_password_input").val(),a("#chat_chatroom_password_input").val(""),input_value=input_value.replace(/^\s+|\s+$/g,""),a(".chat_chatroom_full_content").html('<div class="chat_nofriends"><div class="chat_loading_icon"></div>'+lang[34]+"</div>"),$chatroom_create.hide(),Ccr=c,loadChatroom(c,crt[c],input_value))}),a("#chat_password_button").click(function(){c=a("#chat_chatroom_password_id").val(),a("#chat_chatroom_password_flyout").hide(),input_value=a("#chat_chatroom_password_input").val(),a("#chat_chatroom_password_input").val(""),input_value=input_value.replace(/^\s+|\s+$/g,""),a(".chat_chatroom_full_content").html('<div class="chat_nofriends"><div class="chat_loading_icon"></div>'+lang[34]+"</div>"),$chatroom_create.hide(),Ccr=c,loadChatroom(c,crt[c],input_value)}),a("#chat_chatroom_stay").click(function(){a(this).toggleClass("chat_menu_unchecked"),a("#chat_chatroom_stay :input").is(":checked")?(a("#chat_chatroom_stay :input").prop("checked",!1),_chatroomstay=-1):(a("#chat_chatroom_stay :input").prop("checked",!0),u_chatroom_stay=Ccr,_chatroomstay=Ccr),a("#chat_chatroom_window :input").is(":checked")&&(a("#chat_chatroom_window").toggleClass("chat_menu_unchecked"),a("#chat_chatroom_window :input").prop("checked",!1)),a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_stay:_chatroomstay},function(){})}),a("#chat_chatroom_window").click(function(){a(this).toggleClass("chat_menu_unchecked"),a("#chat_chatroom_window :input").is(":checked")?(a("#chat_chatroom_window :input").prop("checked",!1),_chatroomwindow=-1):(a("#chat_chatroom_window :input").prop("checked",!0),u_chatroom_open=Ccr,_chatroomwindow=Ccr),a("#chat_chatroom_stay :input").is(":checked")&&(a("#chat_chatroom_stay").toggleClass("chat_menu_unchecked"),a("#chat_chatroom_stay :input").prop("checked",!1)),a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_window:_chatroomwindow},function(){})}),a("#chat_chatroom_block").click(function(){lsClick("#chat_chatroom_block","ac_click"),a(this).toggleClass("chat_menu_unchecked"),a("#chat_chatroom_block :input").is(":checked")?(a("#chat_chatroom_block :input").prop("checked",!1),_chatroomblock=-1):(a("#chat_chatroom_block :input").prop("checked",!0),_chatroomblock=1),a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_block_chats:_chatroomblock},function(){})}),a("#chat_chatroom_sound").click(function(){lsClick("#chat_chatroom_sound","ac_click"),a(this).toggleClass("chat_menu_unchecked"),a("#chat_chatroom_sound :input").is(":checked")?(a("#chat_chatroom_sound :input").prop("checked",!1),_chatroomsound=-1,u_chatroom_sound=0):(a("#chat_chatroom_sound :input").prop("checked",!0),_chatroomsound=1,u_chatroom_sound=1),a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_sound:_chatroomsound},function(){})}),a("#chat_chatroom_show_names").click(function(){lsClick("#chat_chatroom_show_names","ac_click"),a(this).toggleClass("chat_menu_unchecked"),a("#chat_chatroom_show_names :input").is(":checked")?(a("#chat_chatroom_show_names :input").prop("checked",!1),_chatroomshownames=-1,u_chatroom_show_names=0,a(".chat_chatroom_message_name").hide(),a(".chat_chatroom_message_avatar").addClass("chat_no_names"),$chatroom_chat.scrollTop(5e4)):(a("#chat_chatroom_show_names :input").prop("checked",!0),_chatroomshownames=1,u_chatroom_show_names=1,a(".chat_chatroom_message_name").show(),a(".chat_chatroom_message_avatar").removeClass("chat_no_names"),$chatroom_chat.scrollTop(5e4)),a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_show_names:_chatroomshownames},function(){})}),a(".chat_chatrooms_title",$chatrooms_popup).click(function(){$chatrooms_button.click()}).children().not(".chat_tab_name").click(function(){return!1}),a(".chat_chatrooms_title",$chatrooms_popup).mouseenter(function(){a(this).addClass("chat_chatboxtabtitlemouseover3")}),a(".chat_chatrooms_title",$chatrooms_popup).mouseleave(function(){a(this).removeClass("chat_chatboxtabtitlemouseover3")}),a("#chat_chatroom_create_input").keydown(function(t){13==t.keyCode&&startCreateChatRoom()}),a("#chat_create_button").click(function(){startCreateChatRoom()}),a("#chat_chatroom_leave").click(function(){lsClick("#chat_chatroom_leave","ac_click"),a(".chat_smiley_box",$chatrooms_popup).is(":visible")&&a(".chat_smiley_box",$chatrooms_popup).hide("slide",{direction:"up"},250,function(){}),a("#chat_chatroom_options_flyout",$chatrooms_popup).is(":visible")&&a(".chat_chatroom_item2").click(),$chatroom_admin_controls.length&&$chatroom_admin_controls.remove(),clearTimeout(Crref2),a(".chat_chatrooms_title .chat_tab_name").html(lang[19]),a(".chat_chatroom_full_content").html('<div class="chat_nofriends"><div class="chat_loading_icon"></div>'+lang[34]+"</div>"),a("#chat_chatroom_leave").hide(),a(".chat_chatroom_popout").hide(),"1"==c_user_chatrooms&&$chatroom_create.show(),chatroomreceived=0,loadChatroomList();var t=Ccr;Ccr=0,1!=c_push_engine?(cancelJSONP(),receiveCore()):changePushChannel("chatroom"+t,0)}),a(".chat_chatroom_leave").mouseenter(function(){showTooltip(a(this),lang[92],0,10,5),a(this).addClass("chat_chatroom_leave_hover"),a("#chat_chatrooms_popup .chat_chatrooms_title").removeClass("chat_chatboxtabtitlemouseover3")}),a(".chat_chatroom_leave").mouseleave(function(){a(this).removeClass("chat_chatroom_leave_hover"),a("#chat_chatrooms_popup .chat_chatrooms_title").addClass("chat_chatboxtabtitlemouseover3"),hideTooltip()}),a(".chat_chatroom_item").click(function(){t(),a(".chat_chatroom_item2").hasClass("chat_more_button_selected")&&a(".chat_chatroom_item2").toggleClass("chat_more_button_selected"),$chatroom_create_flyout.is(":visible")?$chatroom_create_flyout.hide("slide",{direction:"up"},250):$chatroom_create_flyout.show("slide",{direction:"up"},250),a("#chat_chatroom_password_flyout").is(":visible")&&(a(".chat_chatroom_list").removeClass("chat_chatroom_clicked"),a("#chat_chatroom_password_flyout").hide("slide",{direction:"up"},250))}),a(".chat_chatroom_item").mouseenter(function(){showTooltip(a(this),lang[93],0,10,5),a(this).parent().addClass("chat_chatroom_create_hover"),a("#chat_chatrooms_popup .chat_chatrooms_title").removeClass("chat_chatboxtabtitlemouseover3")}),a(".chat_chatroom_item").mouseleave(function(){hideTooltip(),a(this).parent().removeClass("chat_chatroom_create_hover"),a("#chat_chatrooms_popup .chat_chatrooms_title").addClass("chat_chatboxtabtitlemouseover3")}),a(".chat_chatroom_item2").click(function(){a("#chat_chatroom_options_flyout").children(".chat_inner_menu").show(),a(".chat_flood_menu").hide(),hideTooltip(),o(),a("#chat_chatroom_options_flyout").toggleClass("chat_chatroom_options_flyout_display"),a(this).addClass("chat_more_button_hover"),a(this).toggleClass("chat_more_button_selected")}),a(".chat_chatroom_item2").mouseenter(function(){showTooltip(a(this),lang[23],0,10,5),a(this).parent().addClass("chat_more_button_hover"),a("#chat_chatrooms_popup .chat_chatrooms_title").removeClass("chat_chatboxtabtitlemouseover3")}),a(".chat_chatroom_item2").mouseleave(function(){hideTooltip(),a(this).parent().removeClass("chat_more_button_hover"),a("#chat_chatrooms_popup .chat_chatrooms_title").addClass("chat_chatboxtabtitlemouseover3")})}function buildPopoutChatButton(){$popout_chat_button=a("<div/>").attr("id","chat_popoutchatbutton").addClass("chat_bar_right").addClass("chat_bar_button").html('<div class="chat_inner_button"><i class="chat_icons chat_popin_icon" /></div>').appendTo($base),$popout_chat_button.mouseover(function(){showTooltip($popout_chat_button,lang[11]),a(this).addClass("chat_tabmouseover")}),$popout_chat_button.mouseout(function(){a(this).removeClass("chat_tabmouseover"),hideTooltip()}),$popout_chat_button.click(function(){a(this).hide(),$buddy_list_tab.show(),$chatboxes.show(),$chatbox_right.show(),$chatbox_left.show(),""!=j&&$user_popups[j].show(),a.post(c_ac_path+"includes/json/send/send_settings.php",{popoutchat:"99"},function(){}),loadBuddyList(),receiveCore(),pushSubscribe(),a.idleTimer(6e4*chat.IdleTime)})}function buildApplicationButtons(){function t(t,a){return t[13]<a[13]?-1:t[13]>a[13]?1:0}var o=apps.slice();apps.sort(t);for(b in apps)"undefined"!=typeof apps[b][0]&&((""==apps[b][10]||0==apps[b][10])&&(apps[b][10]=16),$application_buttons[apps[b][0]]=a("<div/>").attr("id","chat_applications_button_"+apps[b][0]).addClass("chat_appname_"+apps[b][2]).addClass("chat_bar_left").addClass("chat_apps_button").css("width",apps[b][10]+"px").html(chat.Templates.applications_bookmarks_tab(c_ac_path,apps,b)).appendTo($base),("1"==apps[b][12]||"1"!=apps[b][9]&&""==u_id||""!=u_id&&"1"!=apps[b][9]&&"1"==u_is_guest)&&1!=c_no_apps_menu&&$application_buttons[apps[b][0]].hide(),""==apps[b][6]&&($application_button_popups[apps[b][0]]=a("<div/>").attr("id","chat_applications_button_"+apps[b][0]+"_popup").addClass("chat_apppopup").css("display","none").html(chat.Templates.applications_bookmarks_window(c_ac_path,apps,b)).appendTo($body)));apps=o.slice(),a(".chat_app_keep_open").addClass("chat_menu_unchecked"),a(".chat_app_keep_open :input").prop("checked",!1),""!=u_apps_open&&"0"!=u_apps_open&&(a("#chat_app_keep_open_"+u_apps_open+" :input").prop("checked",!0),a("#chat_app_keep_open_"+u_apps_open).removeClass("chat_menu_unchecked")),a(".chat_apps_button").mouseover(function(){var t=a(this).attr("id").substr(30);$application_buttons[t].hasClass("chat_trayclick")||(apps[t][10]<=16||""==apps[t][10])&&showTooltip($application_buttons[t],apps[t][1],!0),a(this).addClass("chat_tabmouseover")}),a(".chat_apps_button").mouseout(function(){a(this).removeClass("chat_tabmouseover"),hideTooltip()}),a(".chat_traytitle").click(function(){var t=a(this).parent().attr("id");t=t.substring(30,t.length-6),$application_buttons[t]&&$application_buttons[t].click()}).children().not(".chat_tab_name").click(function(){return!1}),a(".chat_traytitle").each(function(t,o){a(o).mouseenter(function(){a(this).addClass("chat_chatboxtabtitlemouseover")}),a(o).mouseleave(function(){a(this).removeClass("chat_chatboxtabtitlemouseover")})}),a(".chat_traytitle .chat_more_button").each(function(t,o){a(o).mouseenter(function(){showTooltip(a(this),lang[23],0,10,5),a(this).addClass("chat_more_button_hover"),a(".chat_traytitle").removeClass("chat_chatboxtabtitlemouseover")}),a(o).mouseleave(function(){hideTooltip(),a(this).removeClass("chat_more_button_hover"),a(".chat_traytitle").addClass("chat_chatboxtabtitlemouseover")})}),a(".chat_traytitle .chat_more_anchor").click(function(){hideTooltip();var t=a(this).attr("id").substr(20);a("#chat_apps_more_popout_"+t).toggle(),a(this).addClass("chat_more_button_hover"),a(this).toggleClass("chat_more_button_selected")}),addHover(a(".chat_menu_item"),"chat_more_hover"),a(".chat_app_keep_open").click(function(){var t=a(this).attr("id").substr(24);if(a(".chat_app_keep_open").addClass("chat_menu_unchecked"),a("#chat_app_keep_open_"+t+" :input").is(":checked")){a("#chat_app_keep_open_"+t+" :input").prop("checked",!1);var o=-1;u_apps_open=""}else{a(".chat_app_keep_open :input").prop("checked",!1),a("#chat_app_keep_open_"+t+" :input").prop("checked",!0);var o=t;u_apps_open=t,a(this).removeClass("chat_menu_unchecked")}a.post(c_ac_path+"includes/json/send/send_settings.php",{app_keep:o},function(){})}),a(".chat_apps_button").click(function(){var t=a(this).attr("id").substr(30);if(closePopup($applications_button_popup,$applications_button),a(this).children(".chat_tabalert").remove(),""==apps[t][6])if(m!=t&&""!==m&&(1==apps[m][7]?closePopup($application_button_popups[m],$application_buttons[m],1):closePopup($application_button_popups[m],$application_buttons[m]),m=""),""==m)$application_button_popups[t].css("left",$application_buttons[t].offset().left).css("bottom","25px").css("width",apps[t][4]),$application_button_popups[t].removeClass("chat_tabopen_hidden"),$application_button_popups[t].addClass("chat_tabopen"),$application_buttons[t].addClass("chat_trayclick"),("1"!=apps[t][7]||"1"!=apps[t][14])&&a.get(c_ac_path+"applications/"+apps[t][2]+"/index.php",function(o){a("#chat_applications_button_"+apps[t][0]+"_content").html(o)}),apps[t][14]=1,m=t;else{1==apps[m][7]?closePopup($application_button_popups[m],$application_buttons[m],1):closePopup($application_button_popups[m],$application_buttons[m]);var o=a("#chatapplist_"+m).parent().attr("id");"chat_other_applications"==o&&$application_buttons[m].hide(),m=""}else window.open(apps[t][6],"self")})}function buildApplicationsButton(){function t(t,a){return t[13]<a[13]?-1:t[13]>a[13]?1:0}$applications_button=a("<div/>").attr("id","chat_applications_button").addClass("chat_bar_left").addClass("chat_bar_button").html(chat.Templates.applications_tab()).appendTo($base),$applications_button_popup=a("<div/>").attr("id","chat_applications_button_popup").addClass("chat_tabpopup").css("display","none").html(chat.Templates.applications_window()).appendTo($body),$applications_button.css("width",c_width_apps+"px"),c_width_apps<=25&&a(".chat_tray_name",$applications_button).hide();var o=apps.slice();apps.sort(t),_appslist='<div style="border-bottom: 1px solid #e9e9e9; color: #808080; margin: 3px 2px 4px;">'+lang[20]+'</div><ul id="chat_applications" class="chat_connectedSortable" style="list-style-type: none; margin: 0px; padding: 0px;min-height:20px;">';for(b in apps)"undefined"!=typeof apps[b][0]&&"1"!=apps[b][12]&&("1"==apps[b][9]&&""==u_id||""!=u_id&&"1"==u_is_guest&&"1"==apps[b][9]||""!=u_id&&"1"!=u_is_guest)&&(_appslist+=chat.Templates.applications_bookmarks_list(c_ac_path,apps,b));_appslist+='</ul><div style="border-bottom: 1px solid #e9e9e9; color: #808080; margin: 8px 2px 4px;">'+lang[64]+'</div><ul id="chat_other_applications" class="chat_connectedSortable" style="list-style-type: none; margin: 0px; padding: 0px;min-height:20px;">';for(b in apps)"undefined"!=typeof apps[b][0]&&"1"==apps[b][12]&&("1"==apps[b][9]&&""==u_id||""!=u_id&&"1"==u_is_guest&&"1"==apps[b][9]||""!=u_id&&"1"!=u_is_guest)&&(_appslist+=chat.Templates.applications_bookmarks_list(c_ac_path,apps,b));_appslist+="</ul>",apps=o.slice(),a("#chat_bookmarks").append("<div>"+_appslist+"</div>"),""!=u_id?a("#chat_applications, #chat_other_applications").sortable({delay:50,connectWith:".chat_connectedSortable",scroll:!1,axis:"y",containment:".chat_traycontent",update:function(){var t=a("#chat_other_applications").sortable("toArray"),o=a(this).sortable("serialize")+"&"+a(this).attr("id")+"=1";a.post(c_ac_path+"includes/json/send/send_settings.php",o,function(){});for(var e=0;e<t.length;e++){var s=t[e].substr(17);$application_buttons[s].hide(),apps[s][12]="1"}for(var o=a("#chat_applications").sortable("toArray"),e=0;e<o.length;e++){var c=o[e].substr(17);$application_buttons[c].show(),apps[c][12]=""}}}):a(".chat_apps_subtitle").hide(),a(".chat_app_link:not(.ui-sortable-helper)").on("click",function(){var t=a(this).attr("id").substr(14);""==apps[t][6]&&($application_buttons[t].show(),closePopup($applications_button_popup,$applications_button)),$application_buttons[t].click()}),a(".chat_traytitle",$applications_button_popup).mouseenter(function(){a(this).addClass("chat_chatboxtabtitlemouseover")}),a(".chat_traytitle",$applications_button_popup).mouseleave(function(){a(this).removeClass("chat_chatboxtabtitlemouseover")}),$applications_button.mouseover(function(){c_width_apps<=25&&($applications_button.hasClass("chat_tabclick")||showTooltip($applications_button,lang[16],!0)),a(this).addClass("chat_tabmouseover")}),$applications_button.mouseout(function(){a(this).removeClass("chat_tabmouseover"),c_width_apps<=25&&hideTooltip()}),a(".chat_traytitle",$applications_button_popup).click(function(){$applications_button.click()}),$applications_button.click(function(){lsClick("#chat_applications_button","ac_openclose"),c_width_apps<=25&&hideTooltip(),""!=m&&($application_buttons[m].click(),m=""),$applications_button_popup.css("left",$applications_button.offset().left).css("bottom","25px"),a(this).toggleClass("chat_tabclick"),$applications_button_popup.toggleClass("chat_tabopen")})}function buildModButton(){$modbutton=a("<div/>").attr("id","chat_modbutton").addClass("chat_bar_right").addClass("chat_bar_button").html(chat.Templates.mod_tab()).appendTo($base),$modbutton_popup=a("<div/>").attr("id","chat_modbutton_popup").addClass("chat_tabpopup").css("display","none").html(chat.Templates.mod_window()).appendTo($body),$modbutton.mouseover(function(){$modbutton_popup.hasClass("chat_tabopen")||(0==$?showTooltip($modbutton,lang[166]):showTooltip($modbutton,lang[166])),a(this).addClass("chat_tabmouseover")}),$modbutton.mouseout(function(){a(this).removeClass("chat_tabmouseover"),hideTooltip()}),$modbutton.click(function(){lsClick("#chat_modbutton","ac_openclose"),a("#chat_modbutton .chat_tabalertnf").length&&a("#chat_modbutton .chat_tabalertnf").remove(),closePopup($chatrooms_popup,$chatrooms_button),closePopup($userstab_popup,$buddy_list_tab),closePopup($optionsbutton_popup,$optionsbutton),hideTooltip(),$modbutton_popup.css("left",$modbutton.offset().left-$modbutton_popup.outerWidth()+$modbutton.outerWidth()).css("bottom","25px"),a(this).toggleClass("chat_tabclick"),$modbutton_popup.toggleClass("chat_tabopen"),$modbutton.toggleClass("chat_modimages_click"),adjustBarSize(),$modbutton.hasClass("chat_tabclick")&&loadModerationContent()}),a(".chat_moderation_title",$modbutton_popup).click(function(){$modbutton.click()}).children().not(".chat_tab_name").click(function(){return!1}),a(".chat_moderation_title",$modbutton_popup).mouseenter(function(){a(this).addClass("chat_chatboxtabtitlemouseover2")}),a(".chat_moderation_title",$modbutton_popup).mouseleave(function(){a(this).removeClass("chat_chatboxtabtitlemouseover2")}),u_num_mod_reports>0&&a("<div/>").css("top","-11px").css("left","8px").addClass("chat_tabalertnf").html(u_num_mod_reports).prependTo($modbutton)}function loadModerationContent(){a(".chat_moderation_full_content").html('<div class="chat_nofriends"><div class="chat_loading_icon"></div>'+lang[34]+"</div>"),a.ajax({url:c_ac_path+"includes/json/receive/receive_moderation.php",cache:!1,type:"get",dataType:"json",success:function(t){buildModerationContent(t)}})}function buildModerationContent(t){a(".chat_moderation_full_content").html(""),a(".chat_reports_subtitle").html('<div class="chat_report_sub_from">'+lang[177]+'</div><div class="chat_report_sub_about">'+lang[178]+'</div><div class="chat_report_sub_time">'+lang[179]+"</div>");var o=!0;t&&a.each(t,function(t,e){"reports"==t&&a.each(e,function(t,e){o=!1,a("<div/>").attr("id","chat_report_"+e.id).mouseover(function(){a(this).addClass("chat_report_list_hover")}).mouseout(function(){a(this).removeClass("chat_report_list_hover")}).addClass("chat_report_list").html('<div class="chat_report_from_image"><img src="'+e.from_pic+'" alt=""></div><div class="chat_report_from_name">'+e.from+'</div><div class="chat_report_about_image"><img src="'+e.about_pic+'" alt=""></div><div class="chat_report_about_name">'+e.about+" ("+e.about_num+')</div><div class="chat_report_time">'+e.time+'</div><div class="chat_clearfix"></div>').appendTo(a(".chat_moderation_full_content"))}),"total_reports"==t&&a(".chat_moderation_title .chat_tab_name").html(lang[166]+" ("+e.count+" "+lang[180]+")")}),(1==c_disable_avatars||a("#chat_setting_names_only :input").is(":checked"))&&(a(".chat_report_from_image").addClass("chat_hide_avatars"),a(".chat_report_about_image").addClass("chat_hide_avatars"),a(".chat_report_from_name").css("width","165px")),o&&a("<div/>").attr("id","chat_report_no_reports").html(lang[189]).appendTo(a(".chat_moderation_full_content")),preventScrolling(a(".chat_moderation_content")),a(".chat_report_list").click(function(t){reportClicked(a(this))})}function reportClicked(t){c="",a(t).attr("id")&&(c=a(t).attr("id").substr(17)),""==c&&(c=a(t).parent().attr("id").substr(17)),a(".chat_moderation_full_content").html('<div class="chat_nofriends"><div class="chat_loading_icon"></div>'+lang[34]+"</div>"),open_report=c,loadReport(c)}function loadReport(t){a.ajax({url:c_ac_path+"includes/json/receive/receive_report.php",data:{reportid:t},type:"post",cache:!1,dataType:"json",success:function(o){if(o){clearTimeout(Crref2);var e=!0;if(o&&a.each(o,function(t,o){"error"==t&&a.each(o,function(t,a){e=!1,open_report=0,displayMessage("chat_moderation_flyout",a.m,"error"),loadModerationContent()})}),e){a(".chat_reports_subtitle").html('<div class="chat_report_sub_back"><a href="javascript:void(0);">'+lang[186]+'</a></div><div class="chat_report_sub_close"><a href="javascript:void(0);">'+lang[185]+'</a></div><div class="chat_report_sub_ban"><a href="javascript:void(0);">'+lang[183]+'</a></div><div class="chat_report_sub_warn"><a href="javascript:void(0);">'+lang[184]+"</a></div>"),a(".chat_moderation_full_content").html(chat.Templates.mod_report()),a(".chat_report_sub_back a").click(function(){loadModerationContent()}),a(".chat_report_sub_close a").click(function(){a(".chat_reports_subtitle").html(""),a(".chat_moderation_full_content").html('<div class="chat_nofriends"><div class="chat_loading_icon"></div>'+lang[34]+"</div>"),
a.post(c_ac_path+"includes/json/send/send_settings.php",{report_id:t},function(){loadModerationContent()})}),a(".chat_report_sub_ban a").click(function(){var o=confirm(lang[195]);1==o&&(a(".chat_reports_subtitle").html(""),a(".chat_moderation_full_content").html('<div class="chat_nofriends"><div class="chat_loading_icon"></div>'+lang[34]+"</div>"),a.post(c_ac_path+"includes/json/send/send_settings.php",{report_ban:t},function(){loadModerationContent()}))}),a(".chat_report_sub_warn a").click(function(){var o=prompt(lang[196]);null!=o&&""!=o&&a.post(c_ac_path+"includes/json/send/send_settings.php",{report_warn:t,report_warn_reason:o},function(e){if(2==e){var s=confirm(lang[197]);1==s&&(a(".chat_reports_subtitle").html(""),a(".chat_moderation_full_content").html('<div class="chat_nofriends"><div class="chat_loading_icon"></div>'+lang[34]+"</div>"),a.post(c_ac_path+"includes/json/send/send_settings.php",{report_warn:t,report_warn_reason:o,report_warn_confirm:1},function(){loadModerationContent()}))}else a(".chat_reports_subtitle").html(""),a(".chat_moderation_full_content").html('<div class="chat_nofriends"><div class="chat_loading_icon"></div>'+lang[34]+"</div>"),loadModerationContent()})}),$report_history=a("#chat_report_history"),$report_list=a("#chat_report_list"),preventScrolling(a("#chat_report_list"));var s=!0,c=0;o&&a.each(o,function(t,o){if("reports"==t&&a.each(o,function(t,o){s=!1,a("<div/>").attr("id","chat_report_list_id_"+o.id).mouseover(function(){a(this).addClass("chat_report_list_hover")}).mouseout(function(){a(this).removeClass("chat_report_list_hover")}).click(function(){o.id!=open_report&&(a("#chat_report_history_content").html('<div class="chat_nofriends"><div class="chat_loading_icon"></div>'+lang[34]+"</div>"),loadReport(o.id),open_report=o.id)}).addClass("chat_report_other_list").html('<span class="chat_report_list_name">'+lang[187]+o.id+"</span>").appendTo(a("#chat_list_reports")),o.id==open_report&&a("#chat_report_list_id_"+o.id).addClass("chat_report_clicked")}),"report_info"==t&&a.each(o,function(t,o){a(".chat_report_info_about").html(lang[190]+'<a href="javascript:void(0);">'+o.about_name+"</a>"),a(".chat_report_info_from").html(lang[191]+'<a href="javascript:void(0);">'+o.from_name+"</a>"),a(".chat_report_info_warnings").html(lang[192]+o.previous_warnings),a(".chat_report_info_time").html(lang[193]+o.time),a(".chat_report_info_about a").click(function(){receiveUser(o.about,uc_name[o.about],uc_status[o.about],uc_avatar[o.about],uc_link[o.about])}),a(".chat_report_info_from a").click(function(){receiveUser(o.from,uc_name[o.from],uc_status[o.from],uc_avatar[o.from],uc_link[o.from])}),c=o.unix}),"report_history"==t){var e="",_=!1;a.each(o,function(t,a){if("undefined"==typeof blockList[a.userid]){var o="",s="";1==a.mod&&(o=lang[137],s=" chat_chatroom_important"),1==a.admin&&(o=lang[136],s=" chat_chatroom_important"),t="",repotee="",fromname=a.n,1==a.reportee&&(repotee=" chat_reportee");var i=new Date(1e3*a.t);a.t>=c&&!_&&(e+='<div class="chat_chatroom_box_message chat_clearfix chat_report_here"><div class="chat_chatroom_message_content chat_global_chatroom_message">'+lang[194]+"</div></div>",_=!0),e+=1==a.global?'<div class="chat_chatroom_box_message chat_clearfix" id="chat_chatroom_message_'+a.id+'"><div class="chat_chatroom_message_content'+t+' chat_global_chatroom_message">'+formatTimestamp(i)+a.m+"</div></div>":'<div class="chat_chatroom_box_message chat_clearfix'+t+repotee+s+'" id="chat_chatroom_message_'+a.id+'"><img class="chat_chatroom_message_avatar chat_no_names" src="'+a.a+'" alt="'+fromname+o+'" /><div class="chat_chatroom_message_name">'+fromname+o+':</div><div class="chat_chatroom_message_content">'+formatTimestamp(i)+'<span class="chat_chatroom_msg">'+a.m+"</span></div></div>"}}),_||(e+='<div class="chat_chatroom_box_message chat_clearfix chat_report_here"><div class="chat_chatroom_message_content chat_global_chatroom_message">'+lang[194]+"</div></div>"),a("#chat_report_history_content").html(e),showChatroomTime()}}),(1==c_disable_avatars||a("#chat_setting_names_only :input").is(":checked"))&&(a(".chat_chatroom_message_avatar").addClass("chat_hide_avatars"),a(".chat_chatroom_message_name").show(),a(".chat_chatroom_message_avatar").removeClass("chat_no_names")),a("#chat_report_history").scrollTop(a("#chat_report_history").scrollTop()+a(".chat_report_here").position().top-a("#chat_report_history").height()/2+a(".chat_report_here").height()/2),a(".chat_image_message img").one("load",function(){a("#chat_report_history").scrollTop(a("#chat_report_history").scrollTop()+a(".chat_report_here").position().top-a("#chat_report_history").height()/2+a(".chat_report_here").height()/2)}).each(function(){this.complete&&a(this).load()}),preventScrolling(a("#chat_report_history")),s&&a("<div/>").attr("id","chat_report_list_none").addClass("chat_report_other_list").html('<span class="chat_report_list_name">'+lang[188]+"</span>").appendTo(a("#chat_list_reports"))}}}})}function receiveWarning(t){if(0==t.read&&""!=t.data){if(a("#chat_warnings").remove(),$body.append(chat.Templates.warnings_display(t)),a("#chat_announcement").length){var o=parseInt(a(window).height()-a("#chat_announcement").position().top);a("#chat_warnings").css("bottom",o+5+"px")}a("#chat_warnings .chat_warnings_close").click(function(){a("#chat_warnings").remove(),a("#chat_announcement").length&&a("#chat_announcement").css("bottom","35px"),a.post(c_ac_path+"includes/json/send/send_settings.php",{warning_read:1},function(){})})}else a("#chat_warnings").remove()}function buildOptionsButton(){$optionsbutton=a("<div/>").attr("id","chat_optionsbutton").addClass("chat_bar_right").addClass("chat_bar_button").html(chat.Templates.notifications_tab()).appendTo($base),$optionsbutton_popup=a("<div/>").attr("id","chat_optionsbutton_popup").addClass("chat_tabpopup").css("display","none").html(chat.Templates.notifications_window()).appendTo($body),$optionsbutton.mouseover(function(){$optionsbutton_popup.hasClass("chat_tabopen")||(0==$?showTooltip($optionsbutton,lang[0]):showTooltip($optionsbutton,lang[0])),a(this).addClass("chat_tabmouseover")}),$optionsbutton.mouseout(function(){a(this).removeClass("chat_tabmouseover"),hideTooltip()}),a(".chat_see_all_link").mouseenter(function(){showTooltip(a(this),lang[21],0,10,5),a(this).parent().addClass("chat_see_all_button_hover"),a("#chat_userstab_popup .chat_userstabtitle").removeClass("chat_chatboxtabtitlemouseover2")}),a(".chat_see_all_link").mouseleave(function(){hideTooltip(),a(this).parent().removeClass("chat_see_all_button_hover"),a("#chat_userstab_popup .chat_userstabtitle").addClass("chat_chatboxtabtitlemouseover2")}),a(".chat_see_all_link").click(function(){lsClick(".chat_see_all_link","ac_click"),a("#chat_notifications_content").html('<div class="chat_loading_icon"></div>');var t=0;a.ajax({url:c_ac_path+"includes/json/receive/receive_notifications.php",type:"get",cache:!1,dataType:"json",success:function(o){o&&null!=o&&(a("#chat_notifications_content").html(""),a.each(o,function(o,e){a.each(e,function(o,e){a("<div/>").attr("id","chat_alert_"+e.alert_id).attr("class","chat_notification_message_div").html(e.markup).appendTo(a("#chat_notifications_content")),t++})}),0==t&&a("#chat_notifications_content").html(lang[9]),a(window).height()-$optionsbutton_popup.height()<80?a("#chat_notifications_content").css("height",a(window).height()-135):a("#chat_notifications_content").css("height","auto"),adjustBarSize())}})}),$optionsbutton.click(function(){lsClick("#chat_optionsbutton","ac_openclose"),a("#chat_notification_alert").length>0&&(a("#chat_notification_alert").remove(),$optionsbutton.removeClass("chat_tab_new_message")),closePopup($modbutton_popup,$modbutton),closePopup($chatrooms_popup,$chatrooms_button),Q>0&&(a("#chat_optionsbutton .chat_tabalertnf").remove(),a.post(c_ac_path+"includes/json/send/send_notifications.php",{userid:u_id},function(){}),Q=0),0==$?(hideTooltip(),$optionsbutton_popup.css("left",$optionsbutton.offset().left-$optionsbutton_popup.outerWidth()+$optionsbutton.outerWidth()).css("bottom","25px"),a(this).toggleClass("chat_tabclick"),$optionsbutton_popup.toggleClass("chat_tabopen"),$optionsbutton.toggleClass("chat_optionsimages_click"),closePopup($userstab_popup,$buddy_list_tab)):""!=lang[16]&&(location.href=lang[16]),a(window).height()-$optionsbutton_popup.height()<80?a("#chat_notifications_content").css("height",a(window).height()-135):a("#chat_notifications_content").css("height","auto"),adjustBarSize()}),a(".chat_userstabtitle",$optionsbutton_popup).click(function(){$optionsbutton.click()}).children().not(".chat_tab_name").click(function(){return!1}),a(".chat_userstabtitle",$optionsbutton_popup).mouseenter(function(){a(this).addClass("chat_chatboxtabtitlemouseover2")}),a(".chat_userstabtitle",$optionsbutton_popup).mouseleave(function(){a(this).removeClass("chat_chatboxtabtitlemouseover2")})}function displayMessage(t,o,e){clearTimeout(message_timeout),a("#"+t).is(":visible")?a("#"+t).hide("slide",{direction:"up"},250,function(){a("#"+t+" .chat_message_text").html(o),"error"==e&&a(".chat_message_box").css("background-color","#ffe2e2").css("border-bottom","1px solid #ffbebe"),"notice"==e&&a(".chat_message_box").css("background-color","#fffae2").css("border-bottom","1px solid #ffecbe"),a("#"+t).show("slide",{direction:"up"},250)}):("error"==e&&a(".chat_message_box").css("background-color","#ffe2e2").css("border-bottom","1px solid #ffbebe"),"notice"==e&&a(".chat_message_box").css("background-color","#fffae2").css("border-bottom","1px solid #ffecbe"),a("#"+t+" .chat_message_text").html(o),a("#"+t).show("slide",{direction:"up"},250)),message_timeout=setTimeout(function(){a("#"+t).hide("slide",{direction:"up"},250)},5e3)}function loadChatroom(t,o,e){a(".chat_chatroom_content").removeClass("chat_chatroom_lobby"),lsClick("#chat_chatroom_"+t,"ac_click");var s=0,c=0,_="";chatroom_mod=0,chatroom_admin=0,chatroomreceived=1,a.ajax({url:c_ac_path+"includes/json/receive/receive_chatroom_room.php",data:{chatroomid:t,chatroom_window:u_chatroom_open,chatroom_stay:u_chatroom_stay,chatroom_pw:e},type:"post",cache:!1,dataType:"json",success:function(o){if(o){clearTimeout(Crref2);var e=!0;if(o&&a.each(o,function(t,o){"error"==t&&a.each(o,function(t,a){e=!1,Ccr=0,chatroomreceived=0,loadChatroomList(),displayMessage("chat_chatroom_message_flyout",a.m,"error")})}),e){Crref2=setTimeout(function(){receiveChatroom(t)},3e4),1!=c_push_engine?(cancelJSONP(),receiveCore()):changePushChannel("chatroom"+t,1),"undefined"!=typeof crt2[t]&&a(".chat_chatrooms_title .chat_tab_name").html(lang[19]+"&nbsp;&nbsp;("+crt2[t]+")"),a("#chat_chatroom_leave").show(),a(".chat_chatroom_full_content").html(chat.Templates.chatrooms_room(c_max_chatroom_msg)),$chatroom_chat=a("#chat_chatroom_chat"),$chatroom_room_list=a("#chat_chatroom_room_list"),1==c_popout_on&&a(".chat_chatroom_popout",$chatrooms_popup).show(),a(".chat_chatroom_popout",$chatrooms_popup).mouseenter(function(){showTooltip(a(this),lang[117],0,10,5),a(this).addClass("chat_chatroom_popout_hover"),a(".chat_chatrooms_title",$chatrooms_popup).removeClass("chat_chatboxtabtitlemouseover3")}),a(".chat_chatroom_popout",$chatrooms_popup).mouseleave(function(){a(this).removeClass("chat_chatroom_popout_hover"),a(".chat_chatrooms_title",$chatrooms_popup).addClass("chat_chatboxtabtitlemouseover3"),hideTooltip()}),a(".chat_chatroom_popout",$chatrooms_popup).unbind("click"),a(".chat_chatroom_popout",$chatrooms_popup).click(function(){a("#chat_chatroom_leave").click(),window.open(c_ac_path+"public/chatroom/?id="+t,"chatroom","menubar=0,resizable=0,width=700,height=450,top=25,left=25,scrollbars=0,status=0")}),a(".chat_chatroom_message_input",$chatrooms_popup).keydown(function(t){return chatroomKeydown(t,a(this))}),a(".chat_chatroom_message_input",$chatrooms_popup).keyup(function(t){return chatroomKeyup(t,a(this))});var i=[];a(".chat_smiley_box",$chatrooms_popup).html("");for(var n=0;n<Smiley.length;n++)a.inArray(Smiley[n][0],i)>-1||(a(".chat_smiley_box",$chatrooms_popup).append('<div class="chat_smiley_wrapper" data-id="'+n+'"><img class="chat_smiley" src="'+c_ac_path+"themes/"+u_theme+"/images/smilies/"+Smiley[n][0]+'.png" alt="" /></div>'),i.push(Smiley[n][0]));a(".chat_smiley_button",$chatrooms_popup).mouseenter(function(){a(this).addClass("chat_smiley_button_hover")}),a(".chat_smiley_button",$chatrooms_popup).mouseleave(function(){a(this).removeClass("chat_smiley_button_hover")}),a(".chat_smiley_wrapper",$chatrooms_popup).click(function(){var t=a(this).attr("data-id"),o=a(".chat_chatroom_message_input",$chatrooms_popup).val();a(".chat_chatroom_message_input",$chatrooms_popup).focus().val("").val(o+Smiley[t][1])}),a(".chat_smiley_button",$chatrooms_popup).click(function(){a(".chat_smiley_popout",$chatrooms_popup).is(":visible")?a(".chat_smiley_popout",$chatrooms_popup).children(".chat_more_popout").hide():a(".chat_smiley_popout",$chatrooms_popup).children(".chat_more_popout").show()}),chatroomUploadProcessing(),1!=c_chatroom_transfer&&a("#chat_upload_button",$chatrooms_popup).hide(),preventScrolling(a(".chat_smiley_box")),preventScrolling(a("#chat_chatroom_chat")),preventScrolling(a("#chat_chatroom_room_list")),1==c_disable_smilies&&(a(".chat_smiley_button").hide(),a(".chat_chatroom_message_input").css("width","99%")),o&&a.each(o,function(o,e){if("user_title"==o&&a.each(e,function(t,a){1==a.admin&&(c=1,chatroom_admin=1),1==a.mod&&(s=1,chatroom_mod=1)}),"chat_name"==o&&a.each(e,function(o,e){"undefined"==typeof crt2[t]&&(crt2[t]=e.n,a(".chat_chatrooms_title .chat_tab_name").html(lang[19]+"&nbsp;&nbsp;("+crt2[t]+")"))}),"chat_users"==o){var i,n=0,h=0,r=0;a.each(e,function(t,o){1!=c&&1!=s||1!=o.t&&4!=o.t||(_='<hr class="chat_options_divider" /><div class="chat_chatroom_options_padding"><div id="chat_chatroom_make_mod_'+o.id+'" class="chat_chatroom_flyout_text">'+lang[52]+'</div></div><div class="chat_chatroom_options_padding"><div id="chat_chatroom_silence_user_'+o.id+'" class="chat_chatroom_flyout_text">'+lang[161]+'</div></div><div class="chat_chatroom_options_padding"><div id="chat_chatroom_ban_user_'+o.id+'" class="chat_chatroom_flyout_text">'+lang[53]+"</div></div>"),1==c&&2==o.t&&(_='<hr class="chat_options_divider" /><div class="chat_chatroom_options_padding"><div id="chat_chatroom_remove_mod_'+o.id+'" class="chat_chatroom_flyout_text">'+lang[54]+"</div></div>"),appendVal=a("#chat_chatroom_list_users"),2==o.t?(appendVal=a("#chat_chatroom_list_mods"),h++):3==o.t?(appendVal=a("#chat_chatroom_list_admins"),n++):r++,i=renderHTMLString(o.n),o.n=renderHTMLString(o.n).length>16?renderHTMLString(o.n).substr(0,16)+"...":o.n,a("<div/>").attr("id","chat_chatroom_user_"+o.id).mouseover(function(){a(this).addClass("chat_chatroom_list_hover")}).mouseout(function(){a(this).removeClass("chat_chatroom_list_hover")}).addClass("chat_chatroom_room_list").addClass("chat_chatroom_admin_"+o.t).html('<img class="chat_chatroom_avatar" src="'+o.a+'"/><span class="chat_chatroom_room_name">'+o.n+'</span><span class="chat_userscontentdot chat_'+o.status+'"></span>').appendTo(appendVal);var e="";(1==o.b&&1!=c||o.id==u_id)&&(e=" chat_no_private_msg"),a("<div/>").attr("id","chat_chatroom_users_flyout_"+o.id).addClass("chat_more_wrapper_chatroom").html('<div class="chat_chatroom_users_flyout"><div class="chat_chatroom_flyout_avatar"><img src="'+o.a+'" alt="" /></div><div class="chat_chatroom_flyout_info"><div class="chat_chatroom_title_padding"><div id="chat_chatroom_title_'+o.id+'" class="chat_chatroom_flyout_text"><a href="'+o.l+'">'+i+"</a><br/>"+lang[43]+'</div></div><hr class="chat_options_divider"/><div class="chat_chatroom_options_padding"><div id="chat_chatroom_private_message_'+o.id+'" class="chat_chatroom_flyout_text'+e+'">'+lang[41]+'</div></div><div class="chat_chatroom_options_padding"><div id="chat_chatroom_block_user_'+o.id+'" class="chat_chatroom_flyout_text">'+lang[84]+'</div></div><div class="chat_chatroom_options_padding"><div id="chat_chatroom_report_user_'+o.id+'" class="chat_chatroom_flyout_text">'+lang[167]+"</div></div>"+_+'</div><div class="chat_clearfix"></div><i class="chat_more_tip_chatroom"></i></div>').appendTo(a("#chat_chatroom_user_"+o.id)),2==o.t?a("#chat_chatroom_title_"+o.id).html('<a href="'+o.l+'">'+i+"</a><br/>"+lang[44]):3==o.t?a("#chat_chatroom_title_"+o.id).html('<a href="'+o.l+'">'+i+"</a><br/>"+lang[45]):4==o.t&&a("#chat_chatroom_title_"+o.id).html('<a href="'+o.l+'">'+i+"</a><br/>"+lang[212]),addHover(a(".chat_chatroom_options_padding"),"chat_options_padding_hover"),chatroomUserOptions(o,c)}),0==r&&a("#chat_chatroom_line_users").hide(),0==n&&a("#chat_chatroom_line_admins").hide(),0==h&&a("#chat_chatroom_line_mods").hide(),a(".chat_chatroom_admin_3").css("background-color","#"+c_admin_bg),a(".chat_chatroom_admin_3").css("color","#"+c_admin_txt)}"chat_history"==o&&(d="",a.each(e,function(t,a){if("undefined"==typeof blockList[a.userid]){var o="",e="";1==a.mod&&(o=lang[137],e=" chat_chatroom_important"),1==a.admin&&(o=lang[136],e=" chat_chatroom_important"),t="",fromname=a.n,a.n==u_name&&(t=" chat_self");var s=new Date(1e3*a.t);1==a.global?d+='<div class="chat_chatroom_box_message chat_clearfix" id="chat_chatroom_message_'+a.id+'"><div class="chat_chatroom_message_content'+t+' chat_global_chatroom_message">'+formatTimestamp(s)+a.m+"</div></div>":d+='<div class="chat_chatroom_box_message chat_clearfix'+t+e+'" id="chat_chatroom_message_'+a.id+'"><img class="chat_chatroom_message_avatar chat_no_names" src="'+a.a+'" alt="'+fromname+o+'" /><div class="chat_chatroom_message_name">'+fromname+o+':</div><div class="chat_chatroom_message_content"><div class="chat_chatroom_delete" data-id="'+a.id+'"> </div>'+formatTimestamp(s)+'<span class="chat_chatroom_msg">'+a.m+"</span></div></div>"}}),a("#chat_chatroom_chat #chat_chatroom_chat_content").html(d),showChatroomTime()),"room_info"==o&&a.each(e,function(a,o){if(""!=o.welcome_msg){var e=stripslashes(o.welcome_msg);room_info[t]=e,e=replaceURLWithHTMLLinks(e),$chatroom_chat.append('<div class="chat_chatroom_box_message chat_clearfix" id="chat_chatroom_welcome_msg"><div class="chat_chatroom_message_content chat_global_chatroom_message">'+e+"</div></div>")}room_desc[t]=o.desc,room_limit_msg[t]=o.limit_msg,room_limit_sec[t]=o.limit_sec})}),modDeleteControls(),(1==c_disable_avatars||a("#chat_setting_names_only :input").is(":checked"))&&(a(".chat_chatroom_avatar").addClass("chat_hide_avatars"),a(".chat_chatroom_message_avatar").addClass("chat_hide_avatars"),a(".chat_chatroom_flyout_avatar").addClass("chat_hide_avatars"),a(".chat_chatroom_message_name").show(),a(".chat_chatroom_message_avatar").removeClass("chat_no_names")),a("#chat_chatroom_show_names :input").is(":checked")&&(a(".chat_chatroom_message_name").show(),a(".chat_chatroom_message_avatar").removeClass("chat_no_names")),$chatroom_chat.scrollTop(5e4),a(".chat_chatroom_message_input").focus(),1==c||1==s?a(".chat_chatroom_admin_menu").length&&a(".chat_flood_menu").length||addChatroomAdminControls():$chatroom_admin_controls.length&&$chatroom_admin_controls.remove(),a(".chat_image_message img").one("load",function(){$chatroom_chat.scrollTop(5e4)}).each(function(){this.complete&&a(this).load()})}else"1"==c_user_chatrooms&&$chatroom_create.show()}}})}function modDeleteControls(){1==chatroom_mod||1==chatroom_admin?(a(".chat_chatroom_delete").show(),a(".chat_chatroom_delete",$chatrooms_popup).unbind("mouseenter").unbind("mouseleave").unbind("click"),a(".chat_chatroom_delete",$chatrooms_popup).mouseenter(function(){showTooltip(a(this),lang[160],0,3,21),a(this).addClass("chat_chatroom_delete_hover")}),a(".chat_chatroom_delete",$chatrooms_popup).mouseleave(function(){hideTooltip(),a(this).removeClass("chat_chatroom_delete_hover")}),a(".chat_chatroom_delete").click(function(){hideTooltip();var t=a(this).attr("data-id");a("#chat_chatroom_message_"+t+" .chat_chatroom_delete").remove(),a.post(c_ac_path+"includes/json/send/send_settings.php",{delete_msg:t,chatroom_id:Ccr,delete_name:u_name},function(){a("#chat_chatroom_message_"+t+" .chat_chatroom_msg").html(lang[159]+u_name)})})):a(".chat_chatroom_delete").hide()}function chatroomUploadProcessing(){var t=Math.round((new Date).getTime()),o=c_ac_path.replace("../","/");a("#chat_upload_button").uploadify({swf:o+"includes/js/uploadify/uploadify.swf",uploader:o+"includes/classes/class_uploads.php",hideButton:!0,buttonText:" ",wmode:"transparent",formData:{unixtime:t,user:u_id},height:25,width:24,multi:!1,auto:!0,fileTypeExts:"*.jpg;*.gif;*.png;*.zip;*.rar;*.jpeg;*.txt;*.doc;*.mp3;*.wmv;*.avi;*.mp4;*.docx;*.wav",fileTypeDesc:"Supported File Types (.JPG, .JPEG, .GIF, .PNG, .WMV, .AVI, .MP4, .ZIP, .RAR, .MP3, .WAV, .TXT, .DOC, .DOCX)",fileSizeLimit:c_max_upload_size+"MB",onSelect:function(){},onCancel:function(){},onUploadComplete:function(){chatroomUploadProcessing()},onUploadError:function(t,a,o,e){displayMessage("chat_chatroom_message_flyout",lang[151],"error")},onUploadSuccess:function(o){var e="file",s=o.type.toLowerCase();(".png"==s||".gif"==s||".jpg"==s||".jpeg"==s)&&(e="image"),a.post(c_ac_path+"includes/json/send/send_message_chatroom.php",{userid:u_id,username:u_name,chatroomid:Ccr,message:e+"{"+t+"}{"+o.name+"}"},function(t){"-1"==t?displayMessage("chat_chatroom_message_flyout",lang[102],"error"):displayMessage("chat_chatroom_message_flyout",lang[68],"notice"),$chatroom_chat.scrollTop(5e4)})}}),a("#chat_upload_button",$chatrooms_popup).mouseenter(function(){a(this).addClass("chat_upload_button_hover")}),a("#chat_upload_button",$chatrooms_popup).mouseleave(function(){a(this).removeClass("chat_upload_button_hover")})}function addChatroomAdminControls(){$chatroom_admin_controls=a("<div/>").addClass("chat_chatroom_admin_menu").html('<li class="chat_menu_separator"></li><li class="chat_menu_item"><a id="chat_edit_description" class="chat_menu_anchor chat_menu_no_check"><span>'+lang[157]+'</span></a></li><li class="chat_menu_item"><a id="chat_edit_welcome" class="chat_menu_anchor chat_menu_no_check"><span>'+lang[153]+'</span></a></li><li class="chat_menu_item"><a id="chat_edit_flood" class="chat_menu_anchor chat_menu_no_check"><span>'+lang[171]+"</span></a></li>").appendTo("#chat_chatroom_options_flyout .chat_inner_menu"),addHover(a(".chat_menu_item"),"chat_more_hover"),a("#chat_edit_welcome").click(function(){var t=prompt(lang[154],room_info[Ccr]);(t||""==t)&&a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_welcome_msg:t,chatroom_id:Ccr},function(){displayMessage("chat_chatroom_message_flyout",lang[155],"notice"),room_info[Ccr]=t,a(".chat_chatroom_item2").click()})}),a("#chat_edit_description").click(function(){var t=prompt(lang[158],room_desc[Ccr]);(t||""==t)&&a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_description:t,chatroom_id:Ccr},function(){displayMessage("chat_chatroom_message_flyout",lang[155],"notice"),room_desc[Ccr]=t,a(".chat_chatroom_item2").click()})}),a("#chat_edit_flood").unbind("click"),a("#chat_edit_flood").click(function(){a(this).parent().parent().parent(".chat_inner_menu").hide(),a("#chat_flood_select_messages").val(room_limit_msg[Ccr]),a("#chat_flood_select_seconds").val(room_limit_sec[Ccr]),a(".chat_flood_menu").show()}),a("#chat_flood_button").unbind("click"),a("#chat_flood_button").click(function(){a(".chat_chatroom_item2").click();var t=a("#chat_flood_select_messages").val(),o=a("#chat_flood_select_seconds").val();isNaN(t)||isNaN(o)||a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_id:Ccr,flood_message:t,flood_seconds:o},function(){displayMessage("chat_chatroom_message_flyout",lang[155],"notice"),room_limit_msg[Ccr]=t,room_limit_sec[Ccr]=o})})}function receiveUser(t,o,e,s,c,_,n){null!=t&&""!=t&&(null!=uc_name[t]&&""!=uc_name[t]||"-1"!=t.toString().search("facebook")?"-1"==t.toString().search("facebook")?toggleUserChatTab(t,uc_name[t],uc_status[t],uc_avatar[t],uc_link[t],_):toggleUserChatTab(t,uc_name[t],uc_status[t],uc_avatar[t],uc_link[t],_,1):1!=aa[t]?(aa[t]=1,a.ajax({url:c_ac_path+"includes/json/receive/receive_user.php",data:{userid:t},type:"post",cache:!1,dataType:"json",success:function(n){n&&(o=uc_name[t]=n.n,e=uc_status[t]=n.s,s=uc_avatar[t]=n.a,c=uc_link[t]=n.l,null!=G[t]&&(a(".chat_closebox_bottom_status",$user[t]).removeClass("chat_available chat_busy chat_offline").addClass("chat_"+e),$users[t].removeClass("chat_tab_offline").addClass("chat_tab_"+o),$user_popups[t].length>0&&a(".chat_tabsubtitle .chat_message",$user_popups[t]).html(i)),aa[t]=0,null!=o?toggleUserChatTab(t,o,e,s,c,_):a.post(c_ac_path+"includes/json/send/send_settings.php",{unfocus_chat:t},function(){}))}})):setTimeout(function(){receiveUser(t,uc_name[t],uc_status[t],uc_avatar[t],uc_link[t],_,n)},500))}function toggleUserChatTab(t,o,e,s,c,_,i){if(null!=G[t])$users[t].hasClass("chat_tabclick")||1==_||(""!=j&&(closePopup($user_popups[j],$users[j]),j=""),$users[t].offset().left<$chatboxes.offset().left+$chatboxes.width()&&$users[t].offset().left-$chatboxes.offset().left>=0?$users[t].click():(a(".chat_tabalert").css("display","none"),s=800,1==get("initialize")&&(s=0),$chatboxes.scrollTo($users[t],s,function(){$users[t].click(),updateRightLastClasses(),positionTabAlerts()}))),updateRightLastClasses();else{$chatboxes_wide.width($chatboxes_wide.width()+148),adjustBarSize(),shortname=renderHTMLString(o).length>12?renderHTMLString(o).substr(0,12)+"...":o,longname=renderHTMLString(o).length>17?renderHTMLString(o).substr(0,17)+"...":o,$users[t]=a(chat.Templates.chat_tab(shortname)).attr("data-id",t).appendTo($chatboxes_wide),$users[t].children(".chat_inner_button").prepend('<div class="chat_closebox_bottom_status chat_'+e+'"></div>'),$users[t].addClass("chat_tab_"+e),$users[t].append('<div class="chat_closebox_bottom"></div>'),a(".chat_closebox_bottom",$users[t]).mouseenter(function(){a(this).addClass("chat_closebox_bottomhover")}),a(".chat_closebox_bottom",$users[t]).mouseleave(function(){a(this).removeClass("chat_closebox_bottomhover")}),a(".chat_closebox_bottom",$users[t]).click(function(){lsClick(".chat_closebox_bottom","ac_click","users['"+t+"']"),a.post(c_ac_path+"includes/json/send/send_settings.php",{close_chat:t,tab_alert:1},function(){}),$user_popups[t].remove(),$users[t].remove(),j==t&&(j=""),$chatboxes_wide.width($chatboxes_wide.width()-148),$chatboxes.scrollTo("-=148px"),adjustBarSize(),y[t]=null,G[t]=null,ca[t]=0}),h=o="",""!=c&&(o='<a href="'+c+'">',h="</a>"),c="",""!=s&&(c='<div class="chat_avatarbox">'+o+'<img src="'+s+'" class="chat_avatar" />'+h+"</div>"),$user_popups[t]=a(chat.Templates.chat_window(o,longname,h,c,t)).css("display","none").appendTo($body),1!=c_video_chat&&a("#chat_video_chat_"+t).hide(),1!=c_file_transfer&&a("#chat_file_transfer_"+t).hide(),1!=c_enable_moderation&&a("#chat_report_"+t).hide(),1!=c_popout_on&&a(".chat_chat_popout").hide(),addHover(a(".chat_video_chat"),"chat_more_hover"),a("#chat_file_cancel_"+t).click(function(){a("#chat_file_upload_div_"+t).hide("slide",{direction:"up"},250)}),a("#chat_file_transfer_"+t).click(function(){var o=Math.round((new Date).getTime()),e=c_ac_path.replace("../","/");a("#chat_file_upload_"+t).uploadify({swf:e+"includes/js/uploadify/uploadify.swf",uploader:e+"includes/classes/class_uploads.php",hideButton:!0,buttonText:" ",wmode:"transparent",formData:{unixtime:o,user:u_id},height:17,width:42,multi:!1,auto:!0,fileTypeExts:"*.jpg;*.gif;*.png;*.zip;*.rar;*.jpeg;*.txt;*.doc;*.mp3;*.wmv;*.avi;*.mp4;*.docx;*.wav",fileTypeDesc:"Supported File Types (.JPG, .JPEG, .GIF, .PNG, .WMV, .AVI, .MP4, .ZIP, .RAR, .MP3, .WAV, .TXT, .DOC, .DOCX)",fileSizeLimit:c_max_upload_size+"MB",onSelect:function(){a(".chat_upload_info_text").hide(),a(".chat_upload_text").hide(),a(".chat_ui_button").css("background","none"),a(".chat_ui_button").css("border","none")},onCancel:function(){a("#chat_file_upload_div_"+t).hide("slide",{direction:"up"},250),a(".chat_upload_info_text").show(),a(".chat_upload_text").show(),a(".chat_ui_button").css("background","#5B74A8"),a(".chat_ui_button").css("border","1px solid #999")},onUploadError:function(o,e,s,c){a("#chat_file_upload_div_"+t).hide(),a(".chat_upload_info_text").show(),a(".chat_upload_text").show(),a(".chat_ui_button").css("background","#5B74A8"),a(".chat_ui_button").css("border","1px solid #999"),displayMessage("chat_chatbox_message_flyout_"+t,lang[151],"error")},onUploadComplete:function(e){var s="file",c=e.type.toLowerCase();(".png"==c||".gif"==c||".jpg"==c||".jpeg"==c)&&(s="image"),a.post(c_ac_path+"includes/json/send/send_message.php",{userid:u_id,to:t,message:s+"{"+o+"}{"+e.name+"}"},function(o){"-1"==o?displayMessage("chat_chatbox_message_flyout_"+t,lang[102],"error"):displayMessage("chat_chatbox_message_flyout_"+t,lang[68],"notice"),a(".chat_tabcontenttext",$user_popups[t]).scrollTop(a(".chat_tabcontenttext",$user_popups[t])[0].scrollHeight)}),a("#chat_file_upload_div_"+t).hide(),a(".chat_upload_info_text").show(),a(".chat_upload_text").show(),a(".chat_ui_button").css("background","#5B74A8"),a(".chat_ui_button").css("border","1px solid #999")}}),a("#chat_more_popout_"+t).toggle(),a("#chat_more_"+t).toggleClass("chat_more_button_selected"),a("#chat_file_upload_div_"+t).show("slide",{direction:"up"},250)}),"offline"==uc_status[t]||"busy"==uc_status[t]?a(".chat_tabtitle .chat_video_icon",$user_popups[t]).addClass("chat_video_unavailable"):a(".chat_tabtitle .chat_video_icon",$user_popups[t]).removeClass("chat_video_unavailable"),a("#chat_video_chat_"+t).click(function(){if("offline"!=uc_status[t]&&"busy"!=uc_status[t]){for(var o=Math.floor(9999999999*Math.random());String(o).length<10;)o="0"+o;jqac.chat.videoWith(o),a.post(c_ac_path+"includes/json/send/send_message.php",{userid:u_id,to:t,message:"video{"+o+"}"},function(o){"-1"==o?displayMessage("chat_chatbox_message_flyout_"+t,lang[102],"error"):displayMessage("chat_chatbox_message_flyout_"+t,lang[63],"notice"),a(".chat_tabcontenttext",$user_popups[t]).scrollTop(a(".chat_tabcontenttext",$user_popups[t])[0].scrollHeight)})}}),preventScrolling(a(".chat_tabcontenttext, .chat_smiley_box"));for(var n=[],h=0;h<Smiley.length;h++)a.inArray(Smiley[h][0],n)>-1||(a(".chat_smiley_box",$user_popups[t]).append('<div class="chat_smiley_wrapper" data-id="'+h+'"><img class="chat_smiley" src="'+c_ac_path+"themes/"+u_theme+"/images/smilies/"+Smiley[h][0]+'.png" alt="" /></div>'),n.push(Smiley[h][0]));a(".chat_smiley_button",$user_popups[t]).mouseenter(function(){a(this).addClass("chat_smiley_button_hover")}),a(".chat_smiley_button",$user_popups[t]).mouseleave(function(){a(this).removeClass("chat_smiley_button_hover")}),a(".chat_smiley_wrapper",$user_popups[t]).click(function(){var o=a(this).attr("data-id"),e=a(".chat_textarea",$user_popups[t]).val();a(".chat_textarea",$user_popups[t]).focus().val("").val(e+Smiley[o][1])}),a(".chat_smiley_button",$user_popups[t]).click(function(){a(".chat_smiley_popout",$user_popups[t]).is(":visible")?a(".chat_smiley_popout",$user_popups[t]).children(".chat_more_popout").hide():a(".chat_smiley_popout",$user_popups[t]).children(".chat_more_popout").show()}),1==c_disable_smilies&&(a(".chat_smiley_button").hide(),a(".chat_textarea").css("width","99%")),a(".chat_tabtitle .chat_more_button",$user_popups[t]).mouseenter(function(){showTooltip(a(this),lang[23],0,10,5),a(this).addClass("chat_more_button_hover"),a(".chat_tabtitle",$user_popups[t]).removeClass("chat_chatboxtabtitlemouseover")}),a(".chat_tabtitle .chat_more_button",$user_popups[t]).mouseleave(function(){hideTooltip(),a(this).removeClass("chat_more_button_hover"),a(".chat_tabtitle",$user_popups[t]).addClass("chat_chatboxtabtitlemouseover")}),a("#chat_more_"+t).click(function(){hideTooltip(),a("#chat_more_popout_"+t).toggle(),a(this).addClass("chat_more_button_hover"),a(this).toggleClass("chat_more_button_selected")}),a("#chat_block_"+t).click(function(){a("#chat_more_popout_"+t).toggle(),a("#chat_more_"+t).toggleClass("chat_more_button_selected"),a(".chat_tabtitle .chat_closebox",$user_popups[t]).click(),a.post(c_ac_path+"includes/json/send/send_settings.php",{
block_chat:t},function(){"undefined"==typeof blockList[t]&&(blockList[t]=t),loadBuddyList()})}),a("#chat_clear_"+t).click(function(){a("#chat_more_popout_"+t).toggle(),a("#chat_more_"+t).toggleClass("chat_more_button_selected"),a("#chat_tabcontenttext_"+t).html(""),a.post(c_ac_path+"includes/json/send/send_settings.php",{clear_chat:t},function(){})}),a("#chat_report_"+t).click(function(){a("#chat_more_popout_"+t).toggle(),a("#chat_more_"+t).toggleClass("chat_more_button_selected"),a.post(c_ac_path+"includes/json/send/send_settings.php",{report_from:u_id,report_about:t},function(){displayMessage("chat_chatbox_message_flyout_"+t,lang[168],"notice")})}),a(".chat_textarea",$user_popups[t]).keydown(function(o){return userchatKeydown(o,a(this),t,i)}),a(".chat_textarea",$user_popups[t]).keyup(function(o){return userchatKeyup(o,a(this),t)}),a(".chat_tabtitle .chat_closebox",$user_popups[t]).mouseenter(function(){showTooltip(a(this),lang[89],0,10,5),a(this).addClass("chat_chatboxmouseoverclose"),a(".chat_tabtitle",$user_popups[t]).removeClass("chat_chatboxtabtitlemouseover")}),a(".chat_tabtitle .chat_closebox",$user_popups[t]).mouseleave(function(){a(this).removeClass("chat_chatboxmouseoverclose"),a(".chat_tabtitle",$user_popups[t]).addClass("chat_chatboxtabtitlemouseover"),hideTooltip()}),a(".chat_tabtitle .chat_closebox",$user_popups[t]).click(function(){lsClick(".chat_tabtitle .chat_closebox","ac_click","user_popups['"+t+"']"),hideTooltip(),a.post(c_ac_path+"includes/json/send/send_settings.php",{close_chat:t,tab_alert:1},function(){}),$user_popups[t].remove(),$users[t].remove(),j==t&&(j=""),$chatboxes_wide.width($chatboxes_wide.width()-148),$chatboxes.scrollTo("-=148px"),adjustBarSize(),G[t]=null,y[t]=null,ca[t]=0}),a(".chat_tabtitle .chat_video_icon",$user_popups[t]).mouseenter(function(){"offline"==uc_status[t]||"busy"==uc_status[t]?showTooltip(a(this),lang[146],0,10,5):(showTooltip(a(this),lang[88],0,10,5),a(this).addClass("chat_video_icon_hover")),a(".chat_tabtitle",$user_popups[t]).removeClass("chat_chatboxtabtitlemouseover")}),a(".chat_tabtitle .chat_video_icon",$user_popups[t]).mouseleave(function(){a(this).removeClass("chat_video_icon_hover"),a(".chat_tabtitle",$user_popups[t]).addClass("chat_chatboxtabtitlemouseover"),hideTooltip()}),a(".chat_more_popout .chat_chat_popout",$user_popups[t]).click(function(){a("#chat_more_popout_"+t).toggle(),a("#chat_more_"+t).toggleClass("chat_more_button_selected"),startPopoutChat()}),a(".chat_more_popout .chat_chat_popout",$user_popups[t]).popupWindow({windowURL:c_ac_path+"public/popout/",height:450,width:700,top:25,left:25}),a(".chat_tabtitle",$user_popups[t]).not(".chat_video_icon").click(function(){$users[t].click()}).children().not(".chat_tab_name").click(function(){return!1}),a(".chat_tabtitle",$user_popups[t]).mouseenter(function(){a(this).addClass("chat_chatboxtabtitlemouseover")}),a(".chat_tabtitle",$user_popups[t]).mouseleave(function(){a(this).removeClass("chat_chatboxtabtitlemouseover")}),$users[t].mouseenter(function(){a(this).addClass("chat_tabmouseover"),a("div",$users[t]).addClass("chat_tabmouseovertext")}),$users[t].mouseleave(function(){a(this).removeClass("chat_tabmouseover"),a("div",$users[t]).removeClass("chat_tabmouseovertext")}),$users[t].click(function(){lsClick(" ","ac_openclose","users['"+t+"']");var o=0;a(".chat_tabalert",$users[t]).length>0&&(o=1,a(".chat_tabalert",$users[t]).remove(),$users[t].removeClass("chat_tab_new_message"),G[t]=0,y[t]=0),a(this).hasClass("chat_tabclick")?(closePopup($user_popups[t],a(this)),a(".chat_closebox_bottom",$users[t]).removeClass("chat_closebox_bottom_click"),j="",a.post(c_ac_path+"includes/json/send/send_settings.php",{unfocus_chat:t,tab_alert:1},function(){})):(""!=j&&(closePopup($user_popups[j],$users[j]),a(".chat_closebox_bottom",$users[j]).removeClass("chat_closebox_bottom_click"),j=""),$users[t].offset().left<$chatboxes.offset().left+$chatboxes.width()&&$users[t].offset().left-$chatboxes.offset().left>=0||($chatboxes.scrollTo($users[t]),updateRightLastClasses()),1!=ca[t]&&(receiveHistory(t),ca[t]=1),a.post(c_ac_path+"includes/json/send/send_settings.php",{focus_chat:t,tab_alert:o},function(){}),$user_popups[t].css("left",$users[t].offset().left-$user_popups[t].outerWidth()+$users[t].outerWidth()).css("bottom","25px"),a(this).addClass("chat_tabclick").addClass("chat_usertabclick"),$user_popups[t].addClass("chat_tabopen"),a(".chat_closebox_bottom",$users[t]).addClass("chat_closebox_bottom_click"),j=t,W&&$user_popups[j].css("position","absolute").css("top",parseInt(a(window).height())-parseInt($user_popups[j].css("bottom"))-parseInt($user_popups[j].height())+a(window).scrollTop()+"px")),a(".chat_tabcontenttext",$user_popups[t]).scrollTop(a(".chat_tabcontenttext",$user_popups[t])[0].scrollHeight),1!=getStatus("updatingsession")&&a(".chat_textarea",$user_popups[t]).focus()}),1!=_&&$users[t].click(),y[t]=0,G[t]=0,1==c_disable_avatars&&(a(".chat_avatarbox").hide(),a("#chat_setting_names_only").parent("li").hide())}}function formatTimestamp(t){var a="am",o=t.getHours(),e=t.getMinutes(),s=t.getDate();t=t.getMonth();var c=o;o>11&&(a="pm"),o>12&&(o-=12),0==o&&(o=12),10>o&&(o=o),10>e&&(e="0"+e);var _=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i="th";return 1==s||21==s||31==s?i="st":2==s||22==s?i="nd":(3==s||23==s)&&(i="rd"),1!=c_us_time?s!=Na?'<span class="chat_ts">'+c+":"+e+" "+s+i+" "+_[t]+"</span>":'<span class="chat_ts">'+c+":"+e+"</span>":s!=Na?'<span class="chat_ts">'+o+":"+e+a+" "+s+i+" "+_[t]+"</span>":'<span class="chat_ts">'+o+":"+e+a+"</span>"}function receiveHistory(t,o){o||(o=1),o>1&&a('<div class="chat_message_history_loading" style="text-align:center;padding:5px 0;"><img src="'+c_ac_path+"themes/"+u_theme+'/images/img-loading.gif" alt="Loading" /></div>').prependTo(a("#chat_tabcontenttext_"+t)),a.ajax({cache:!1,url:c_ac_path+"includes/json/receive/receive_history.php",data:{chatbox:t,history:o},type:"post",dataType:"json",success:function(e){if(a(".chat_message_history_loading").remove(),history_ids[t]=0,numMessages=0,e){1==o&&a(".chat_tabcontenttext",$user_popups[t]).html(""),last_sent[t]=null;var s="",c=uc_name[t],_=!1;a.each(e,function(o,e){"messages"==o&&a.each(e,function(a,o){numMessages++,a="",1==o.self?(fromname=u_name,fromid=u_id,a=" chat_self",_aa5=_aa4="",avatar=u_avatar,tooltip=lang[90]):(fromname=c,fromid=t,_aa4='<a href="'+uc_link[t]+'">',_aa5="</a>",avatar=uc_avatar[o.from],tooltip=fromname);var e=fromid,i=new Date(1e3*o.sent);"1"!=c_show_full_name&&-1!=fromname.indexOf(" ")&&(fromname=fromname.slice(0,fromname.indexOf(" "))),s+='<div class="chat_chatboxmessage chat_clearfix'+a+'" id="chat_message_'+o.id+'">'+formatTimestamp(i)+'<div class="chat_chatboxmessagefrom"><div class="chat_disable_avatars_name">'+fromname+'</div><img alt="'+tooltip+'" class="chat_chatbox_avatar" src="'+avatar+'" /></div><div class="chat_chatboxmessage_wrapper"><div class="chat_chatboxmessagecontent">'+o.message+"</div></div></div>",last_sent[o.from]=o.sent,last_name[o.from]=e,_=!0,last_id[o.from]=o.id})});var i=a("#chat_tabcontenttext_"+t).children().children().first();o>1?a(s).prependTo(a("#chat_tabcontenttext_"+t).children("div")):a("#chat_tabcontenttext_"+t).html("<div>"+s+"</div>"),showTimeAndTooltip(),(1==c_disable_avatars||a("#chat_setting_names_only :input").is(":checked"))&&setAvatarVisibility(1);var n=0;i.prevAll().each(function(){n+=a(this).outerHeight()}),1==o?a("#chat_tabcontenttext_"+t).scrollTop(5e4):a("#chat_tabcontenttext_"+t).scrollTop(n),a("#chat_tabcontenttext_"+t).scroll(function(){a("#chat_tabcontenttext_"+t).scrollTop()<50&&1!=history_ids[t]&&(history_ids[t]=1,20==numMessages&&(o++,receiveHistory(t,o)))}),a(".chat_image_message img").one("load",function(){a("#chat_tabcontenttext_"+t).scrollTop(5e4)}).each(function(){this.complete&&a(this).load()})}}})}function showTimeAndTooltip(){a(".chat_chatbox_avatar").mouseenter(function(){showTooltip(a(this),a(this).attr("alt"),!1,55,-38,1)}),a(".chat_chatbox_avatar").mouseleave(function(){hideTooltip()}),a(".chat_chatboxmessage").mouseenter(function(){a(this).children(".chat_ts").show()}),a(".chat_chatboxmessage").mouseleave(function(){a(this).children(".chat_ts").hide()}),a(".chat_lightbox").click(function(){a.slimbox(a(this).attr("data-id"),'<a href="'+a(this).attr("data-id")+'">'+lang[70]+"</a>",{resizeDuration:1,overlayFadeDuration:1,imageFadeDuration:1,captionAnimationDuration:1})})}function showChatroomTime(){a(".chat_chatroom_message_avatar").mouseenter(function(){showTooltip(a(this),a(this).attr("alt"),!1,50,-28,1)}),a(".chat_chatroom_message_avatar").mouseleave(function(){hideTooltip()}),a(".chat_chatroom_box_message").mouseenter(function(){a(".chat_chatroom_message_name").is(":visible")&&a(this).children(".chat_chatroom_message_content").children(".chat_ts").addClass("chat_ts_name_fix"),a(this).children(".chat_chatroom_message_content").children(".chat_ts").show()}),a(".chat_chatroom_box_message").mouseleave(function(){a(this).children(".chat_chatroom_message_content").children(".chat_ts").removeClass("chat_ts_name_fix"),a(this).children(".chat_chatroom_message_content").children(".chat_ts").hide()}),a(".chat_lightbox").click(function(){a.slimbox(a(this).attr("data-id"),'<a href="'+a(this).attr("data-id")+'">'+lang[70]+"</a>",{resizeDuration:1,overlayFadeDuration:1,imageFadeDuration:1,captionAnimationDuration:1})})}function notifyNewMessage(t,o,e){null==uc_name[t]||""==uc_name[t]?setTimeout(function(){notifyNewMessage(t,o,e)},500):(receiveUser(t,uc_name[t],uc_status[t],uc_avatar[t],uc_link[t],1),1==e&&a(".chat_tabalert",$users[t]).length>0&&(o=parseInt(a(".chat_tabalert",$users[t]).html())+parseInt(o)),0==o?($users[t].removeClass("chat_tab_new_message"),a(".chat_tabalert",$users[t]).remove()):(a(".chat_tabalert",$users[t]).length>0?(a(".chat_tabalert",$users[t]).html(o),1==bounce3&&(bounce3=0,a(".chat_tabalert",$users[t]).stop(!0,!0).effect("bounce",{times:3,distance:5},200,function(){bounce3=1}))):a("<div/>").css("top","-11px").css("left","112px").addClass("chat_tabalert").html(o).appendTo($users[t]),$users[t].removeClass("chat_tab_new_message").addClass("chat_tab_new_message")),y[t]=o,positionTabAlerts())}function setAvatarVisibility(t){1==t?(a(".chat_userlist_avatar").addClass("chat_hide_avatars"),a(".chat_chatroom_avatar").addClass("chat_hide_avatars"),a(".chat_chatroom_flyout_avatar").addClass("chat_hide_avatars"),a(".chat_chatroom_message_avatar").addClass("chat_hide_avatars"),a(".chat_chatroom_message_name").show(),a(".chat_chatroom_message_avatar").removeClass("chat_no_names"),a(".chat_chatbox_avatar").hide(),a(".chat_disable_avatars_name").show(),a(".chat_chatboxmessage_wrapper").addClass("chat_chatboxmessage_wrapper2"),a(".chat_chatboxmessagecontent").addClass("chat_chatboxmessagecontent2")):(a(".chat_userlist_avatar").removeClass("chat_hide_avatars"),a(".chat_chatroom_avatar").removeClass("chat_hide_avatars"),a(".chat_chatroom_flyout_avatar").removeClass("chat_hide_avatars"),a(".chat_chatroom_message_avatar").removeClass("chat_hide_avatars"),a(".chat_chatroom_message_name").hide(),a(".chat_chatroom_message_avatar").addClass("chat_no_names"),a(".chat_chatbox_avatar").show(),a(".chat_disable_avatars_name").hide(),a(".chat_chatboxmessage_wrapper").removeClass("chat_chatboxmessage_wrapper2"),a(".chat_chatboxmessagecontent").removeClass("chat_chatboxmessagecontent2"))}function buildBuddyListTab(){var t="";$buddy_list_tab=a("<div/>").attr("id","chat_buddy_list_tab").addClass("chat_bar_button").addClass("chat_bar_right").html(chat.Templates.buddylist_tab()).appendTo($base),$userstab_popup=a("<div/>").attr("id","chat_userstab_popup").addClass("chat_tabpopup").css("display","none").html(chat.Templates.buddylist_window(t,_ts,acp)).appendTo($body),1==c_disable_avatars&&(a("#chat_name_box").hide(),a("#chat_setting_names_only").parent("li").hide()),$buddy_list_tab.css("width",c_width_blist+"px"),c_width_blist<=25&&a("#chat_userstab_text").hide(),1!=c_theme_change&&a(".chat_theme_button").hide(),a(".chat_powered_by").css("display","none"),a(".chat_search_friends_text").placeholder(),1==u_sounds?a("#chat_setting_sound :input").prop("checked",!0):(a("#chat_setting_sound").addClass("chat_menu_unchecked"),a("#chat_setting_sound :input").prop("checked",!1)),1==u_blist_open?a("#chat_setting_window_open :input").prop("checked",!0):(a("#chat_setting_window_open").addClass("chat_menu_unchecked"),a("#chat_setting_window_open :input").prop("checked",!1)),1==u_no_avatars?a("#chat_setting_names_only :input").prop("checked",!0):(a("#chat_setting_names_only").addClass("chat_menu_unchecked"),a("#chat_setting_names_only :input").prop("checked",!1)),1==u_is_guest&&1==c_guest_name_change&&""==u_guest_name&&a(".chat_enter_name_wrapper").show(),a("#chat_guest_name_input").placeholder(),a("#chat_guest_name_input").keydown(function(t){13==t.keyCode&&a.post(c_ac_path+"includes/json/send/send_settings.php",{chat_name:a(this).val()},function(t){"1"!=t?displayMessage("chat_buddylist_message_flyout",t,"error"):(a(".chat_enter_name_wrapper").slideUp("fast"),u_name=a(this).val())})}),a(".chat_search_friends_text").keyup(function(){a(".chat_search_not_found").remove();var t=1,o=!0,e="",s=a(this).val();""==s?(a(".chat_userlist").each(function(){e=a(this).attr("id").substr(14),a("#chat_userlist_"+e).removeClass("chat_userlist_hover2").show(),a("#chat_userlist_"+e+" > span.chat_userscontentname:icontains('"+s+"')").removeHighlight()}),o=!1):a(".chat_userlist").each(function(){e=a(this).attr("id").substr(14),a("#chat_userlist_"+e+" > span.chat_userscontentname:icontains('"+s+"')").length>0?(a("#chat_userlist_"+e).removeClass("chat_userlist_hover2").show(),1==t&&a("#chat_userlist_"+e).addClass("chat_userlist_hover2"),a("#chat_userlist_"+e+" > span.chat_userscontentname:icontains('"+s+"')").removeHighlight(),a("#chat_userlist_"+e+" > span.chat_userscontentname:icontains('"+s+"')").highlight(s),o=!1,t++):a("#chat_userlist_"+e).hide()}),o&&a("<div/>").attr("class","chat_search_not_found chat_nofriends").html(lang[26]).prependTo("#chat_userscontent"),adjustBarSize()}),a(document).bind("idle.idleTimer",function(){1!=w&&(clearUserStatus(),a("#chat_userstab_icon").addClass("chat_user_away2"),setUserStatus("away"),isAway=1)}),a(document).bind("active.idleTimer",function(){1!=w&&(clearUserStatus(),setUserStatus("available"),a("#chat_userstab_icon").addClass("chat_user_available2"),isAway=0)}),a.idleTimer(6e4*chat.IdleTime),a("#chat_theme_button").click(function(){a("#chat_theme_flyout").toggleClass("chat_theme_flyout_display"),a(".chat_theme_link").addClass("chat_theme_button_hover"),a(".chat_theme_link").toggleClass("chat_more_button_selected");var t=a(".chat_themeswitcher").val();a.post(c_ac_path+"includes/json/send/send_settings.php",{theme:t},function(o){a("#chat_css").attr({href:c_ac_path+"external.php?type=css&t="+t}),window.location.reload()})}),a("#chat_setting_sound").click(function(){lsClick("#chat_setting_sound","ac_click"),a(this).toggleClass("chat_menu_unchecked"),a("#chat_setting_sound :input").is(":checked")?(a("#chat_setting_sound :input").prop("checked",!1),_soundcheck=-1,u_sounds=0):(a("#chat_setting_sound :input").prop("checked",!0),_soundcheck=1,u_sounds=1),a.post(c_ac_path+"includes/json/send/send_settings.php",{sound:_soundcheck},function(){})}),a("#chat_setting_window_open").click(function(){a(this).toggleClass("chat_menu_unchecked"),a("#chat_setting_window_open :input").is(":checked")?(a("#chat_setting_window_open :input").prop("checked",!1),_windowcheck=-1):(a("#chat_setting_window_open :input").prop("checked",!0),_windowcheck=1),a.post(c_ac_path+"includes/json/send/send_settings.php",{window:_windowcheck},function(){})}),a("#chat_setting_names_only").click(function(){lsClick("#chat_setting_names_only","ac_click"),a(this).toggleClass("chat_menu_unchecked"),a("#chat_setting_names_only :input").is(":checked")?(a("#chat_setting_names_only :input").prop("checked",!1),setAvatarVisibility(0),_namecheck=-1):(a("#chat_setting_names_only :input").prop("checked",!0),setAvatarVisibility(1),_namecheck=1),a.post(c_ac_path+"includes/json/send/send_settings.php",{name:_namecheck},function(){})}),a("#chat_setting_block_list").click(function(){a(this).parent().parent(".chat_inner_menu").hide(),a(".chat_block_menu").show(),a.ajax({url:c_ac_path+"includes/json/receive/receive_block_list.php",type:"get",cache:!1,dataType:"json",success:function(t){t&&null!=t&&(a(".chat_block_menu select").html(""),a("<option/>").attr("value","0").html(lang[118]).appendTo(a(".chat_block_menu select")),a.each(t,function(t,o){a.each(o,function(t,o){a("<option/>").attr("value",o.id).html(o.username).appendTo(a(".chat_block_menu select"))})}))}})}),a("#chat_unblock_button").click(function(){a(".chat_panel_item").click();var t=a(".chat_block_menu select").val();"0"!=t&&a.post(c_ac_path+"includes/json/send/send_settings.php",{unblock_chat:t},function(){"undefined"!=typeof blockList[t]&&blockList.splice(t,1),loadBuddyList()})}),preventScrolling(a("#chat_userscontent")),a(".chat_theme_link").mouseenter(function(){showTooltip(a(this),lang[94],0,10,5),a(this).parent().addClass("chat_theme_button_hover"),a("#chat_userstab_popup .chat_userstabtitle").removeClass("chat_chatboxtabtitlemouseover2")}),a(".chat_theme_link").mouseleave(function(){hideTooltip(),a(this).parent().removeClass("chat_theme_button_hover"),a("#chat_userstab_popup .chat_userstabtitle").addClass("chat_chatboxtabtitlemouseover2")}),a(".chat_theme_link").click(function(){hideTooltip(),a("#chat_userscontent").height()<150?a("#chat_theme_wrapper").addClass("flyout_reversed"):a("#chat_theme_wrapper").removeClass("flyout_reversed"),a("#chat_theme_flyout").toggleClass("chat_theme_flyout_display"),a(this).addClass("chat_theme_button_hover"),a(this).toggleClass("chat_more_button_selected"),a(".chat_panel_item").hasClass("chat_more_button_selected")&&(a(".chat_panel_item").toggleClass("chat_more_button_selected"),a("#chat_options_flyout").toggleClass("chat_options_flyout_display"))}),a(".chat_panel_item").mouseenter(function(){showTooltip(a(this),lang[23],0,10,5),a(this).parent().addClass("chat_more_button_hover"),a("#chat_userstab_popup .chat_userstabtitle").removeClass("chat_chatboxtabtitlemouseover2")}),a(".chat_panel_item").mouseleave(function(){hideTooltip(),a(this).parent().removeClass("chat_more_button_hover"),a("#chat_userstab_popup .chat_userstabtitle").addClass("chat_chatboxtabtitlemouseover2")}),a(".chat_panel_item").click(function(){hideTooltip(),a("#chat_userscontent").height()<150?a("#chat_options_wrapper").addClass("flyout_reversed"):a("#chat_options_wrapper").removeClass("flyout_reversed"),a("#chat_options_flyout").toggleClass("chat_options_flyout_display"),a(this).addClass("chat_more_button_hover"),a(this).toggleClass("chat_more_button_selected"),a(".chat_theme_link").hasClass("chat_more_button_selected")&&(a(".chat_theme_link").toggleClass("chat_more_button_selected"),a("#chat_theme_flyout").toggleClass("chat_theme_flyout_display")),a("#chat_options_flyout").children(".chat_inner_menu").show(),a(".chat_block_menu").hide()}),addHover(a(".chat_menu_item"),"chat_more_hover"),a("#chat_gooffline").click(function(){lsClick("#chat_gooffline","ac_click"),a(".chat_panel_item").click(),a(".chat_userstabtitle").toggleClass("chat_userstabtitle_button_click"),pushCancelAll(),cancelJSONP(),a.idleTimer("destroy"),clearTimeout(Z),""!=j&&(closePopup($user_popups[j],$users[j]),a(".chat_closebox_bottom",$users[j]).removeClass("chat_closebox_bottom_click"),j=""),a("#chat_panel_options").removeClass("chat_panel_hover"),showUserOffline(),a("#chat_userstab_icon").addClass("chat_user_invisible2"),$chatboxes.hide()}),a("#chat_userstab_popup .chat_userstabtitle").click(function(){$buddy_list_tab.click()}).children().not(".chat_tab_name").click(function(){return!1}),a("#chat_userstab_popup .chat_userstabtitle").mouseenter(function(){a(this).addClass("chat_chatboxtabtitlemouseover2")}),a("#chat_userstab_popup .chat_userstabtitle").mouseleave(function(){a(this).removeClass("chat_chatboxtabtitlemouseover2")}),$buddy_list_tab.mouseover(function(){c_width_blist<=25&&($buddy_list_tab.hasClass("chat_tabclick")||showTooltip($buddy_list_tab,lang[4])),a(this).addClass("chat_tabmouseover")}),$buddy_list_tab.mouseout(function(){a(this).removeClass("chat_tabmouseover"),hideTooltip()}),$buddy_list_tab.click(function(){lsClick("#chat_buddy_list_tab","ac_openclose"),c_width_blist<=25&&hideTooltip(),closePopup($chatrooms_popup,$chatrooms_button),(1==w||1==bli)&&(clearTimeout(Z),loadBuddyList(),bli=0),1==w&&(w=0,a("#chat_userstab_text").html("<b>"+lang[4]+"</b> (<b>"+R+"</b>)"),receiveCore(),pushSubscribe(),a.idleTimer(6e4*chat.IdleTime),setUserStatus("available"),a("#chat_userstab_icon").addClass("chat_user_available2"),$chatboxes.show()),closePopup($optionsbutton_popup,$optionsbutton),closePopup($modbutton_popup,$modbutton),$userstab_popup.css("left",$buddy_list_tab.offset().left-$userstab_popup.outerWidth()+$buddy_list_tab.outerWidth()).css("bottom","25px"),a(this).toggleClass("chat_tabclick").toggleClass("chat_userstabclick"),$userstab_popup.toggleClass("chat_tabopen"),adjustBuddyListSize()})}function startPopoutChat(){pushCancelAll(),cancelJSONP(),a.idleTimer("destroy"),clearTimeout(Z),$buddy_list_tab.hide(),$popout_chat_button.show(),$chatboxes.hide(),$chatbox_right.hide(),$chatbox_left.hide(),closePopup($userstab_popup,$buddy_list_tab),closePopup($optionsbutton_popup,$optionsbutton),closePopup($modbutton_popup,$modbutton),closePopup($chatrooms_popup,$chatrooms_button),""!=j&&(closePopup($user_popups[j],$users[j]),a(".chat_closebox_bottom",$users[j]).removeClass("chat_closebox_bottom_click"),j=""),a.post(c_ac_path+"includes/json/send/send_settings.php",{popoutchat:"1"},function(){})}function adjustBuddyListSize(){var t=0,o=0,e=0;a("#chat_search_friends").is(":visible")&&(t=a("#chat_search_friends").outerHeight()),a(".chat_enter_name_wrapper").is(":visible")&&(o=a(".chat_enter_name_wrapper").outerHeight()),a(".chat_powered_by").is(":visible")&&(e=a(".chat_powered_by").outerHeight()),a(window).outerHeight()-a("#chat_userscontent")[0].scrollHeight<=c_window_top_padding+t+o+e&&a("#chat_userscontent").outerHeight()<=a("#chat_userslist_available").outerHeight()+a("#chat_userslist_away").outerHeight()+a("#chat_userslist_busy").outerHeight()+a("#chat_userslist_offline").outerHeight()+a("#chat_site_users").outerHeight(!0)?a("#chat_userscontent").css("height",a(window).outerHeight()-(c_window_top_padding+t+o+e)+"px"):a("#chat_userscontent").css("height","auto")}function adjustBarSize(){if(1!=c_chat_maintenance&&""!=u_id){if(void 0!==$optionsbutton_popup){var t=0;a(".chat_notification_message_div").each(function(){t+=parseInt(a(this).outerHeight())+5}),a(window).height()-a("#chat_notifications_content")[0].scrollHeight<=c_window_top_padding&&a("#chat_notifications_content").outerHeight()<=t?a("#chat_notifications_content").css("height",a(window).height()-c_window_top_padding+"px"):a("#chat_notifications_content").css("height","auto")}adjustBuddyListSize()}var o=a(window).width(),e=0;for($chatbox_right.hasClass("chat_chatbox_lr")||(e=19),t=0;t<barLinks.length;t++)e+=a("#chat_trayicon_"+t).outerWidth();void 0!==$optionsbutton&&(e+=$optionsbutton.outerWidth()),void 0!==$modbutton&&(e+=$modbutton.outerWidth()),void 0!==$chatrooms_button&&(e+=$chatrooms_button.outerWidth()),void 0!==a("#chat_hide_bar_button")&&(e+=a("#chat_hide_bar_button").outerWidth());var s=0;for(bha in apps)"1"!=apps[bha][12]&&"undefined"!=typeof $application_buttons[apps[bha][0]]&&(e+=$application_buttons[apps[bha][0]].outerWidth());if(void 0!==$applications_button&&(e+=$applications_button.outerWidth()),1==c_no_apps_menu&&(e+=130),barLinks.length>0&&s>0&&(e+=30),positionBar(e),1!=c_chat_maintenance&&""!=u_id){if($chatboxes_wide.width()<=$base.width()-250-e)$chatboxes.css("width",$chatboxes_wide.width()),$chatboxes.scrollTo("0px",0);else{o=$chatboxes.width();var c=148*Math.floor(($base.width()-250-e)/148);148>c&&(c=148),$chatboxes.css("width",c+"px"),e=$chatboxes.width(),o!=e&&$chatboxes.scrollTo("-=148px",0)}0!=c_notifications&&$optionsbutton_popup.css("left",$optionsbutton.offset().left-$optionsbutton_popup.outerWidth()+$optionsbutton.outerWidth()).css("bottom","25px"),1==c_enable_moderation&&1==u_is_mod&&$modbutton_popup.css("left",$modbutton.offset().left-$modbutton_popup.outerWidth()+$modbutton.outerWidth()).css("bottom","25px"),0!=c_chatrooms&&$chatrooms_popup.css("left",$chatrooms_button.offset().left-$chatrooms_popup.outerWidth()+$chatrooms_button.outerWidth()).css("bottom","25px"),"undefined"!=typeof $applications_button_popup&&0!=c_applications_on&&$applications_button_popup.css("left",$applications_button.offset().left).css("bottom","25px"),$userstab_popup.css("left",$buddy_list_tab.offset().left-$userstab_popup.outerWidth()+$buddy_list_tab.outerWidth()).css("bottom","25px"),""!=m&&$application_button_popups[m].css("left",$application_buttons[m].offset().left).css("bottom","25px"),""!=j&&($users[j].offset().left<$chatboxes.offset().left+$chatboxes.width()&&$users[j].offset().left-$chatboxes.offset().left>=0?$user_popups[j].css("left",$users[j].offset().left-$user_popups[j].outerWidth()+$users[j].outerWidth()).css("bottom","25px"):(closePopup($user_popups[j],$users[j]),e=$users[j].offset().left-$chatboxes_wide.offset().left-148*(Math.floor($chatboxes.width()/148)-1),$chatboxes.scrollTo(e,0,function(){"undefined"!=typeof $users[j]&&$users[j].click()}))),positionTabAlerts(),updateRightLastClasses(),W&&positionchat()}}function positionBar(t){var o=a(window).width();if(1==c_bar_fixed){if($base.css("width",c_bar_fixed_width),"left"==c_bar_fixed_alignment&&$base.css("left",c_bar_padding),"center"==c_bar_fixed_alignment){var e=(o-c_bar_fixed_width)/2;$base.css("left",e)}if("right"==c_bar_fixed_alignment){var e=o-c_bar_fixed_width;$base.css("left",e-c_bar_padding)}}else{var s=parseInt(450)+parseInt(t)+parseInt(2*c_bar_padding);s>o&&(o=s),$base.css("left",c_bar_padding+"px"),$base.css("width",o-2*c_bar_padding)}}function positionTabAlerts(){var t=a(".chat_tabalertlr",$chatbox_left),o=a(".chat_tabalertlr",$chatbox_right);t.html("0").css("display","none"),o.html("0").css("display","none"),a(".chat_tabalert").each(function(){if("chat_chatrooms_button"!=a(this).parent().attr("id")&&!a(this).parent().hasClass("chat_apps_button"))if(a(this).parent().offset().left<$chatboxes.offset().left+$chatboxes.width()&&a(this).parent().offset().left-$chatboxes.offset().left>=0)a(this).css("display","block");else if(a(this).css("display","none"),a(this).parent().offset().left-$chatboxes.offset().left>=0){var e=$chatbox_right.offset().left+$chatbox_right.width()-30;o.html(parseInt(a(".chat_tabalertlr",$chatbox_right).html())+parseInt(a(this).html())).css({display:"block",left:e})}else e=$chatbox_left.offset().left+$chatbox_left.width()-22,t.html(parseInt(a(".chat_tabalertlr",$chatbox_left).html())+parseInt(a(this).html())).css({display:"block",left:e})})}function updateRightLastClasses(){var t=0,o=!1,e=!1;if($chatbox_right.hasClass("chat_chatbox_right_last")&&(o=!0),$chatbox_right.hasClass("chat_chatbox_lr")&&(e=!0),0==$chatboxes.scrollLeft())a(".chat_tabtext",$chatbox_left).html("0"),$chatbox_left.addClass("chat_chatbox_left_last"),a(".chat_previous_tab").addClass("chat_previous_tab_last"),t++;else{var s=Math.floor($chatboxes.scrollLeft()/148);a(".chat_tabtext",$chatbox_left).html(s),$chatbox_left.removeClass("chat_chatbox_left_last"),a(".chat_previous_tab").removeClass("chat_previous_tab_last")}$chatboxes.scrollLeft()+$chatboxes.width()==$chatboxes_wide.width()?(a(".chat_tabtext",$chatbox_right).html("0"),$chatbox_right.addClass("chat_chatbox_right_last"),a(".chat_next_tab").addClass("chat_next_tab_last"),t++):(s=Math.floor(($chatboxes_wide.width()-($chatboxes.scrollLeft()+$chatboxes.width()))/148),a(".chat_tabtext",$chatbox_right).html(s),$chatbox_right.removeClass("chat_chatbox_right_last"),a(".chat_next_tab").removeClass("chat_next_tab_last")),2==t?($chatbox_right.addClass("chat_chatbox_lr"),$chatbox_left.addClass("chat_chatbox_lr")):($chatbox_right.removeClass("chat_chatbox_lr"),$chatbox_left.removeClass("chat_chatbox_lr")),(!$chatbox_right.hasClass("chat_chatbox_right_last")&&o||$chatbox_right.hasClass("chat_chatbox_right_last")&&!o||!$chatbox_right.hasClass("chat_chatbox_lr")&&e||$chatbox_right.hasClass("chat_chatbox_lr")&&!e)&&adjustBarSize()}function scrollChatboxes(t){""!=j&&closePopup($user_popups[j],$users[j]),a(".chat_tabalert").css("display","none");var o=100;1==get("initialize")&&(o=0),$chatboxes.scrollTo(t,o,function(){""!=j&&($users[j].offset().left<$chatboxes.offset().left+$chatboxes.width()&&$users[j].offset().left-$chatboxes.offset().left>=0?$users[j].click():j=""),positionTabAlerts(),updateRightLastClasses()})}function set(t,a){V[t]=a}function get(t){return V[t]?V[t]:""}function getStatus(t){return xa[t]?xa[t]:""}function receiveUserFromUserlist(t){if(a(t).attr("id"))var o=a(t).attr("id").substr(14);else var o="";""==o&&(o=a(t).parent().attr("id").substr(14)),receiveUser(o,uc_name[o],uc_status[o],uc_avatar[o],uc_link[o]),lsClick("#chat_userlist_"+o,"ac_click")}function chatroomListClicked(t){$chatroom_create_flyout.is(":visible")&&$chatroom_create_flyout.hide("slide",{direction:"up"},250),c="",a(t).attr("id")&&(c=a(t).attr("id").substr(14)),""==c&&(c=a(t).parent().attr("id").substr(14)),2==crt[c]?(a("#chat_chatroom_password_id").val(c),a("#chat_chatroom_"+c).hasClass("chat_chatroom_clicked")?(a("#chat_chatroom_password_flyout").hide("slide",{direction:"up"},250),a(".chat_chatroom_list").removeClass("chat_chatroom_clicked")):(a(".chat_chatroom_list").removeClass("chat_chatroom_clicked"),a("#chat_chatroom_"+c).addClass("chat_chatroom_clicked"),a("#chat_chatroom_password_flyout").is(":visible")?(a("#chat_chatroom_password_flyout").hide("slide",{direction:"up"},250),a("#chat_chatroom_password_flyout").show("slide",{direction:"up"},250,function(){a("#chat_chatroom_password_input").focus()})):a("#chat_chatroom_password_flyout").show("slide",{direction:"up"},250,function(){a("#chat_chatroom_password_input").focus()}))):(a(".chat_chatroom_full_content").html('<div class="chat_nofriends"><div class="chat_loading_icon"></div>'+lang[34]+"</div>"),a("#chat_chatroom_password_flyout").is(":visible")&&a("#chat_chatroom_password_flyout").hide("slide",{direction:"up"},250),$chatroom_create.hide(),Ccr=c,loadChatroom(c,crt[c]))}function addMessageToChatroom(t,o,e){var s="",c="";1==chatroom_mod&&(s=lang[137],c=" chat_chatroom_important"),1==chatroom_admin&&(s=lang[136],c=" chat_chatroom_important"),e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/\"/g,"&quot;"),e=replaceURLWithHTMLLinks(e),e=smileyreplace(e),a("#chat_chatroom_message_"+t).length>0||($chatroom_chat.append('<div class="chat_chatroom_box_message chat_clearfix chat_self'+c+'" id="chat_chatroom_message_'+t+'"><img class="chat_chatroom_message_avatar chat_no_names" src="'+u_avatar+'" alt="'+o+s+'" /><div class="chat_chatroom_message_name">'+o+s+':</div><div class="chat_chatroom_message_content"><div class="chat_chatroom_delete" data-id="'+t+'"> </div>'+formatTimestamp(new Date(1e3*Math.floor((new Date).getTime()/1e3)))+'<span class="chat_chatroom_msg">'+e+"</span></div></div>"),$chatroom_chat.scrollTop(5e4)),showChatroomTime(),modDeleteControls()}function addMessageToChatbox(t,o,e,s,c,_,i){if(1!=aa[t]&&receiveUser(t,uc_name[t],uc_status[t],uc_avatar[t],uc_link[t],1,1),null==uc_name[t]||""==uc_name[t])setTimeout(function(){addMessageToChatbox(t,o,e,s,c,_,i)},500);else{var n="";1==parseInt(e)?(fromname=u_name,fromid=u_id,n=" chat_self",avatar=u_avatar,tooltip=lang[90]):(fromname=uc_name[t],fromid=t,avatar=uc_avatar[t],tooltip=fromname);var h=fromid;1==parseInt(_)&&(o=o.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/\"/g,"&quot;")),o=replaceURLWithHTMLLinks(o),o=smileyreplace(o),1!=e&&1==u_sounds&&!a(".chat_textarea",$user_popups[t]).is(":focus")&&playNewMessageSound(),
separator=":&nbsp;&nbsp;",a("#chat_message_"+c).length>0?a("#chat_message_"+c+" .chat_chatboxmessagecontent").html(o):("1"!=c_show_full_name&&-1!=fromname.indexOf(" ")&&(fromname=fromname.slice(0,fromname.indexOf(" "))),"offline"==uc_status[t]&&1!=e&&displayMessage("chat_chatbox_message_flyout_"+t,lang[13],"error"),a(".chat_tabcontenttext",$user_popups[t]).append('<div class="chat_chatboxmessage chat_clearfix'+n+'" id="chat_message_'+c+'">'+formatTimestamp(new Date(1e3*i))+'<div class="chat_chatboxmessagefrom"><div class="chat_disable_avatars_name">'+fromname+'</div><img alt="'+tooltip+'" class="chat_chatbox_avatar" src="'+avatar+'" /></div><div class="chat_chatboxmessage_wrapper"><div class="chat_chatboxmessagecontent">'+o+"</div></div></div>"),last_sent[t]=i,last_name[t]=h,last_id[t]=c,(1==c_disable_avatars||a("#chat_setting_names_only :input").is(":checked"))&&setAvatarVisibility(1),a("#chat_tabcontenttext_"+t).scrollTop(5e4),showTimeAndTooltip()),j!=t&&1!=e&&1!=s&&notifyNewMessage(t,1,1),1!=e&&showDesktopNotification(t,o,c)}}function activateUser(t){null==uc_name[t]||""==uc_name[t]?setTimeout(function(){activateUser(t)},500):j!=t&&$users[t].click()}function addMessageToContent(t,o){null==uc_name[t]||""==uc_name[t]?setTimeout(function(){addMessageToContent(t,o)},500):(a("#chat_tabcontenttext_"+t).append("<div>"+o+"</div>"),a("#chat_tabcontenttext_"+t).scrollTop(5e4),G[t]=1)}function loadChatroomList(){0==chatroomreceived&&(a(".chat_chatroom_content").addClass("chat_chatroom_lobby"),a("#chat_chatroom_leave").hide(),a(".chat_chatroom_popout").hide(),a.ajax({url:c_ac_path+"includes/json/receive/receive_chatroom_list.php",cache:!1,data:{chatroom_window:u_chatroom_open,chatroom_stay:u_chatroom_stay},type:"post",dataType:"json",success:function(t){buildChatroomList(t)}}))}function buildChatroomList(t){Ccr=0,a(".chat_chatroom_full_content").html("");t&&a.each(t,function(t,o){"chatrooms"==t&&a.each(o,function(t,o){a("<div/>").attr("id","chat_chatroom_"+o.id).mouseover(function(){a(this).addClass("chat_chatroom_list_hover")}).mouseout(function(){a(this).removeClass("chat_chatroom_list_hover")}).addClass("chat_chatroom_list").html('<div class="chat_chatroom_image"><img src="'+c_ac_path+"themes/"+u_theme+"/images/icons/"+o.img+'" alt="" /></div><div class="chat_chatroom_name_wrapper"><div class="chat_chatroom_name">'+o.n+'</div><div class="chat_chatroom_desc">'+o.d+'</div></div><span class="chat_chatroom_status chat_chatroom_'+o.t+'"></span><span class="chat_chatroom_count">'+o.c+lang[35]+'</span><div class="chat_clearfix"></div>').appendTo(a(".chat_chatroom_full_content")),crt[o.id]=o.t,crt2[o.id]=o.n})}),chatroomreceived=1,a(".chat_chatroom_list").click(function(t){chatroomListClicked(a(this))})}function receiveChatroom(t){var o=0,e=0,s="";chatroom_mod=0,chatroom_admin=0,Ccr==t&&(a.ajax({url:c_ac_path+"includes/json/receive/receive_chatroom.php",cache:!1,type:"post",data:{chatroomid:t},dataType:"json",success:function(t){if(t){var c=!0;t&&a.each(t,function(t,o){"error"==t&&a.each(o,function(t,a){c=!1,Ccr=0,chatroomreceived=0,loadChatroomList(),displayMessage("chat_chatroom_message_flyout",a.m,"error")})}),c&&(t&&a.each(t,function(t,c){if("user_title"==t&&a.each(c,function(t,a){1==a.admin&&(e=1,chatroom_admin=1),1==a.mod&&(o=1,chatroom_mod=1)}),"chat_users"==t){var _,i=0,n=0,h=0;$chatroom_room_list.html('<div id="chat_chatroom_line_admins" class="chat_group_container"><span class="chat_group_text">'+lang[148]+'</span><div class="chat_group_line_container"><span class="chat_group_line"></span></div></div><div id="chat_chatroom_list_admins"></div><div id="chat_chatroom_line_mods" class="chat_group_container"><span class="chat_group_text">'+lang[149]+'</span><div class="chat_group_line_container"><span class="chat_group_line"></span></div></div><div id="chat_chatroom_list_mods"></div><div id="chat_chatroom_line_users" class="chat_group_container"><span class="chat_group_text">'+lang[147]+'</span><div class="chat_group_line_container"><span class="chat_group_line"></span></div></div><div id="chat_chatroom_list_users"></div>'),a.each(c,function(t,c){1!=e&&1!=o||1!=c.t&&4!=c.t||(s='<hr class="chat_options_divider" /><div class="chat_chatroom_options_padding"><div id="chat_chatroom_make_mod_'+c.id+'" class="chat_chatroom_flyout_text">'+lang[52]+'</div></div><div class="chat_chatroom_options_padding"><div id="chat_chatroom_silence_user_'+c.id+'" class="chat_chatroom_flyout_text">'+lang[161]+'</div></div><div class="chat_chatroom_options_padding"><div id="chat_chatroom_ban_user_'+c.id+'" class="chat_chatroom_flyout_text">'+lang[53]+"</div></div>"),1==e&&2==c.t&&(s='<hr class="chat_options_divider" /><div class="chat_chatroom_options_padding"><div id="chat_chatroom_remove_mod_'+c.id+'" class="chat_chatroom_flyout_text">'+lang[54]+"</div></div>"),appendVal=a("#chat_chatroom_list_users"),2==c.t?(appendVal=a("#chat_chatroom_list_mods"),n++):3==c.t?(appendVal=a("#chat_chatroom_list_admins"),i++):h++,_=renderHTMLString(c.n),c.n=renderHTMLString(c.n).length>16?renderHTMLString(c.n).substr(0,16)+"...":c.n,a("<div/>").attr("id","chat_chatroom_user_"+c.id).mouseover(function(){a(this).addClass("chat_chatroom_list_hover")}).mouseout(function(){a(this).removeClass("chat_chatroom_list_hover")}).addClass("chat_chatroom_room_list").addClass("chat_chatroom_admin_"+c.t).html('<img class="chat_chatroom_avatar" src="'+c.a+'"/><span class="chat_chatroom_room_name">'+c.n+'</span><span class="chat_userscontentdot chat_'+c.status+'"></span>').appendTo(appendVal);var r="";(1==c.b&&1!=e||c.id==u_id)&&(r=" chat_no_private_msg"),a("<div/>").attr("id","chat_chatroom_users_flyout_"+c.id).addClass("chat_more_wrapper_chatroom").html('<div class="chat_chatroom_users_flyout"><div class="chat_chatroom_flyout_avatar"><img src="'+c.a+'" alt="" /></div><div class="chat_chatroom_flyout_info"><div class="chat_chatroom_title_padding"><div id="chat_chatroom_title_'+c.id+'" class="chat_chatroom_flyout_text"><a href="'+c.l+'">'+_+"</a><br/>"+lang[43]+'</div></div><hr class="chat_options_divider"/><div class="chat_chatroom_options_padding"><div id="chat_chatroom_private_message_'+c.id+'" class="chat_chatroom_flyout_text'+r+'">'+lang[41]+'</div></div><div class="chat_chatroom_options_padding"><div id="chat_chatroom_block_user_'+c.id+'" class="chat_chatroom_flyout_text">'+lang[84]+'</div></div><div class="chat_chatroom_options_padding"><div id="chat_chatroom_report_user_'+c.id+'" class="chat_chatroom_flyout_text">'+lang[167]+"</div></div>"+s+'</div><div class="chat_clearfix"></div><i class="chat_more_tip_chatroom"></i></div>').appendTo(a("#chat_chatroom_user_"+c.id)),2==c.t?a("#chat_chatroom_title_"+c.id).html('<a href="'+c.l+'">'+_+"</a><br/>"+lang[44]):3==c.t?a("#chat_chatroom_title_"+c.id).html('<a href="'+c.l+'">'+_+"</a><br/>"+lang[45]):4==c.t&&a("#chat_chatroom_title_"+c.id).html('<a href="'+c.l+'">'+_+"</a><br/>"+lang[212]),addHover(a(".chat_chatroom_options_padding"),"chat_options_padding_hover"),chatroomUserOptions(c,e),uc_avatar[c.id]=c.a}),0==h&&a("#chat_chatroom_line_users").hide(),0==i&&a("#chat_chatroom_line_admins").hide(),0==n&&a("#chat_chatroom_line_mods").hide(),a(".chat_chatroom_admin_3").css("background-color","#"+c_admin_bg),a(".chat_chatroom_admin_3").css("color","#"+c_admin_txt)}}),modDeleteControls(),1==e||1==o?a(".chat_chatroom_admin_menu").length&&a(".chat_flood_menu").length||addChatroomAdminControls():$chatroom_admin_controls.length&&$chatroom_admin_controls.remove(),(1==c_disable_avatars||a("#chat_setting_names_only :input").is(":checked"))&&(a(".chat_chatroom_avatar").addClass("chat_hide_avatars"),a(".chat_chatroom_message_avatar").addClass("chat_hide_avatars"),a(".chat_chatroom_flyout_avatar").addClass("chat_hide_avatars"),a(".chat_chatroom_message_name").show(),a(".chat_chatroom_message_avatar").removeClass("chat_no_names")),a("#chat_chatroom_show_names :input").is(":checked")&&(a(".chat_chatroom_message_name").show(),a(".chat_chatroom_message_avatar").removeClass("chat_no_names")))}}}),clearTimeout(Crref2),Crref2=setTimeout(function(){receiveChatroom(t)},6e4))}function chatroomUserOptions(t,o){a("#chat_chatroom_make_mod_"+t.id).click(function(){a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_mod:t.id,chatroom_id:Ccr},function(){receiveChatroom(Ccr)}),toggleChatroomUserInfo(t.id)}),a("#chat_chatroom_remove_mod_"+t.id).click(function(){a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_remove_mod:t.id,chatroom_id:Ccr},function(){receiveChatroom(Ccr)}),toggleChatroomUserInfo(t.id)}),a("#chat_chatroom_block_user_"+t.id).click(function(){a.post(c_ac_path+"includes/json/send/send_settings.php",{block_chat:t.id},function(a){"-1"!=a&&("undefined"==typeof blockList[t.id]&&(blockList[t.id]=t.id),loadBuddyList(),displayMessage("chat_chatroom_message_flyout",lang[103],"notice"))}),toggleChatroomUserInfo(t.id)}),1!=c_enable_moderation&&a("#chat_chatroom_report_user_"+t.id).hide(),a("#chat_chatroom_report_user_"+t.id).click(function(){a.post(c_ac_path+"includes/json/send/send_settings.php",{report_about:t.id,report_from:u_id,report_chatroom:Ccr},function(t){displayMessage("chat_chatroom_message_flyout",lang[168],"notice")}),toggleChatroomUserInfo(t.id)}),a("#chat_chatroom_ban_user_"+t.id).click(function(){var o=prompt(lang[57]);null==o||""==o||isNaN(o)||a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_ban:t.id,chatroom_id:Ccr,chatroom_ban_length:o},function(){receiveChatroom(Ccr)}),toggleChatroomUserInfo(t.id)}),a("#chat_chatroom_silence_user_"+t.id).click(function(){var o=prompt(lang[162]);null==o||""==o||isNaN(o)||a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_silence:t.id,chatroom_id:Ccr,chatroom_silence_length:o},function(){}),toggleChatroomUserInfo(t.id)}),a("#chat_chatroom_private_message_"+t.id).click(function(){1!=t.b||1==o?u_id!=t.id&&jqac.chat.chatWith(t.id):displayMessage("chat_chatroom_message_flyout",lang[46],"error"),toggleChatroomUserInfo(t.id)}),a("#chat_chatroom_user_"+t.id).click(function(){crou!=t.id&&(a("#chat_chatroom_user_"+crou).removeClass("chat_chatroom_clicked"),a("#chat_chatroom_users_flyout_"+crou).removeClass("chat_chatroom_create_flyout_display")),crou=t.id,toggleChatroomUserInfo(t.id),a("#chat_chatroom_users_flyout_"+t.id).css("top",a("#chat_chatroom_user_"+crou).position().top-a("#chat_chatroom_users_flyout_"+t.id).height()+a("#chat_chatroom_user_"+crou).height()+12+"px")}).children("#chat_chatroom_users_flyout_"+t.id).click(function(o){return a(o.target).is("a")?void(window.location=t.l):!1})}function toggleChatroomUserInfo(t){a("#chat_chatroom_user_"+t).toggleClass("chat_chatroom_clicked"),a("#chat_chatroom_users_flyout_"+t).toggleClass("chat_chatroom_create_flyout_display")}function loadBuddyList(){if(clearTimeout(Z),a.ajax({url:c_ac_path+"includes/json/receive/receive_buddylist.php",cache:!1,type:"get",dataType:"json",success:function(t){buildBuddyList(t),1==c_disable_avatars&&a(".chat_userlist_avatar").addClass("chat_hide_avatars"),adjustBuddyListSize(),adjustBarSize()}}),"undefined"!=typeof c_list_heart_beat)var t=1e3*c_list_heart_beat;else var t=6e4;Z=setTimeout(function(){loadBuddyList()},t)}function buildBuddyList(t){V.timestamp=ma;var o={},e="";o.available="",o.busy="",o.offline="",o.invisible="",o.away="",onlineNumber=buddylistreceived=0,t&&a.each(t,function(t,s){if("buddylist"==t&&(buddylistreceived=1,totalFriendsNumber=onlineNumber=0,a.each(s,function(t,s){longname=renderHTMLString(s.n).length>16?renderHTMLString(s.n).substr(0,16)+"...":s.n,null!=G[s.id]&&(a(".chat_closebox_bottom_status",$users[s.id]).removeClass("chat_available").removeClass("chat_busy").removeClass("chat_offline").removeClass("chat_away").addClass("chat_"+s.s),$users[s.id].removeClass("chat_tab_offline").removeClass("chat_away").addClass("chat_tab_"+s.s),$user_popups[s.id].length>0&&a(".chat_tabsubtitle .chat_message",$user_popups[s.id]).html(s.m),"offline"==s.s||"busy"==s.s?a(".chat_tabtitle .chat_video_icon",$user_popups[s.id]).addClass("chat_video_unavailable"):a(".chat_tabtitle .chat_video_icon",$user_popups[s.id]).removeClass("chat_video_unavailable")),("available"==s.s||"away"==s.s||"busy"==s.s)&&onlineNumber++,totalFriendsNumber++,a("#chat_setting_names_only :input").is(":checked")&&(e="chat_hide_avatars"),o[s.s]+='<div id="chat_userlist_'+s.id+'" class="chat_userlist chat_buddylist_admin_'+s.admin+'" onmouseover="jqac(this).addClass(\'chat_userlist_hover\');" onmouseout="jqac(this).removeClass(\'chat_userlist_hover\');"><img class="chat_userlist_avatar '+e+'" src="'+s.a+'" /><span class="chat_userscontentname">'+longname+'</span><span class="chat_userscontentdot chat_'+s.s+'"></span></div>',uc_status[s.id]=s.s,uc_name[s.id]=s.n,uc_avatar[s.id]=s.a,uc_link[s.id]=s.l})),1==buddylistreceived&&0==bli){for(buddystatus in o)o.hasOwnProperty(buddystatus)&&(""==o[buddystatus]?a("#chat_userslist_"+buddystatus).html(""):a("#chat_userslist_"+buddystatus).html("<div>"+o[buddystatus]+"</div>"));a(".chat_userlist").click(function(t){a(this).hasClass("chat_jabber_user")||receiveUserFromUserlist(t.target)}),a("#chat_userstab_text").html("<b>"+lang[4]+"</b> (<b>"+onlineNumber+"</b>)"),R=onlineNumber,0==totalFriendsNumber&&a("#chat_userslist_available").html('<div class="chat_nofriends">'+lang[8]+"</div>"),0==R&&a("#chat_userslist_available").html('<div class="chat_nofriends">'+lang[8]+"</div>"),R>=c_search_min?a("#chat_search_friends").show():a("#chat_search_friends").hide(),buddylistreceived=0}else a("#chat_userstab_text").html("<b>"+lang[4]+"</b> (<b>"+onlineNumber+"</b>)");a(".chat_buddylist_admin_1").css("background-color","#"+c_admin_bg),a(".chat_buddylist_admin_1").css("color","#"+c_admin_txt)})}function cancelJSONP(){"undefined"!=typeof CHA&&clearTimeout(CHA),"undefined"!=typeof xOptions&&xOptions.abort()}function receiveCore(){cancelJSONP();var t=c_ac_path+"includes/json/receive/receive_core.php?hash="+u_hash_id+"&init="+acsi+"&room="+Ccr;if(xOptions=a.ajax({url:t,dataType:"jsonp",success:function(t){V.timestamp=ma;var o="",e={};if(e.available="",e.busy="",e.offline="",e.away="",onlineNumber=buddylistreceived=0,t&&null!=t){var s=0;a.each(t,function(t,c){if("typing"==t&&a.each(c,function(t,a){"1"==a.is_typing?receiveTyping(a.typing_id):receiveNotTyping(a.typing_id)}),"announcements"==t&&a.each(c,function(t,a){receiveAnnouncement(a)}),"warnings"==t&&a.each(c,function(t,a){receiveWarning(a)}),"chatroom"==t){var _=0,i="";a.each(c,function(t,o){1==o.action?a("#chat_chatroom_message_"+o.m+" .chat_chatroom_msg").html(lang[159]+o.n):("undefined"==typeof blockList[o.userid]&&addChatroomMessage(o.id,o.n,o.m,o.userid,o.t,o.global,o.mod,o.admin),i=o,_++)}),"undefined"!=typeof i&&_>0&&"undefined"==typeof blockList[i.userid]&&(showChatroomTime(),chatroomAlerts(_),i.userid!=u_id&&1==u_chatroom_sound&&!a(".chat_chatroom_message_input").is(":focus")&&playNewMessageSound())}if("notifications"==t){var n="";a.each(c,function(t,a){addNotification(a.alert_id,a.markup),n=a.markup}),notificationAlerts(n)}if("messages"==t){var h=0;a.each(c,function(t,o){receiveMessage(o.id,o.from,o.message,o.sent,o.self,o.old),a(".chat_textarea",$user_popups[o.from]).is(":focus")||(h=1)}),K=1,D=E,""!=j&&s>0&&addMessageToContent(j,o),showTimeAndTooltip(),1!=e&&1==u_sounds&&1==h&&1!=acsi&&playNewMessageSound()}})}set("initialize","0"),set("currenttime","0"),1!=$&&1!=w&&(K++,K>4&&(D*=2,K=1),D>12e3&&(D=12e3)),acsi++}}),1==isAway)var o=1e3*c_heart_beat*3;else var o=1e3*c_heart_beat;1!=c_push_engine&&(CHA=setTimeout(function(){receiveCore()},o))}function addChatroomMessage(t,o,e,s,c,_,i,n){s==u_id&&(uc_avatar[u_id]=u_avatar),e=stripslashes(e),e=replaceURLWithHTMLLinks(e);var h=new Date(1e3*c);"undefined"==typeof uc_avatar[s]?a.ajax({url:c_ac_path+"includes/json/receive/receive_user.php",data:{userid:s},type:"post",cache:!1,dataType:"json",success:function(a){a&&(uc_avatar[s]=a.a,chatroomDiv(t,uc_avatar[s],o,h,e,_,i,n,s))}}):chatroomDiv(t,uc_avatar[s],o,h,e,_,i,n,s),count++}function chatroomDiv(t,o,e,s,c,_,i,n,h){var r=$chatroom_chat[0].scrollHeight-$chatroom_chat.scrollTop()-10,l=$chatroom_chat.outerHeight(),p="",u="",d="";h==u_id&&(u="chat_self"),1==i&&(p=lang[137],d="chat_chatroom_important"),1==n&&(p=lang[136],d="chat_chatroom_important"),a("#chat_chatroom_message_"+t).length>0?(a("#chat_chatroom_message_"+t+" .chat_chatroom_msg").html(c),h==u_id&&a("#chat_chatroom_message_"+t).addClass(u)):(1==_?(a("<div/>").attr("id","chat_chatroom_message_"+t).addClass("chat_chatroom_box_message").addClass("chat_clearfix").html('<div class="chat_chatroom_message_content chat_global_chatroom_message">'+formatTimestamp(s)+c+"</div>").appendTo($chatroom_chat),receiveChatroom(Ccr)):a("<div/>").attr("id","chat_chatroom_message_"+t).addClass(d).addClass(u).addClass("chat_chatroom_box_message").addClass("chat_clearfix").html('<img class="chat_chatroom_message_avatar chat_no_names" src="'+o+'" alt="'+e+p+'" /><div class="chat_chatroom_message_name">'+e+p+':</div><div class="chat_chatroom_message_content"><div class="chat_chatroom_delete" data-id="'+t+'"> </div>'+formatTimestamp(s)+'<span class="chat_chatroom_msg">'+c+"</span></div>").appendTo($chatroom_chat),(1==c_disable_avatars||a("#chat_setting_names_only :input").is(":checked"))&&(a(".chat_chatroom_avatar").addClass("chat_hide_avatars"),a(".chat_chatroom_message_avatar").addClass("chat_hide_avatars"),a(".chat_chatroom_flyout_avatar").addClass("chat_hide_avatars"),a(".chat_chatroom_message_name").show(),a(".chat_chatroom_message_avatar").removeClass("chat_no_names")),a("#chat_chatroom_show_names :input").is(":checked")&&(a(".chat_chatroom_message_name").show(),a(".chat_chatroom_message_avatar").removeClass("chat_no_names")),l>=r?($chatroom_chat.scrollTop(5e4),a(".chat_image_message img").one("load",function(){setTimeout(function(){$chatroom_chat.scrollTop(5e4)},500)}).each(function(){this.complete&&a(this).load()})):displayMessage("chat_chatroom_message_flyout",lang[134],"notice"),showChatroomTime(),modDeleteControls())}function chatroomAlerts(t){if(a("#chat_chatrooms_button .chat_tabalert").length>0&&t>0){var o=parseInt(a("#chat_chatrooms_button .chat_tabalert").html())+t;a("#chat_chatrooms_button .chat_tabalert").html(o),1==bounce2&&(bounce2=0,a("#chat_chatrooms_button .chat_tabalert").stop(!0,!0).effect("bounce",{times:3,distance:5},200,function(){bounce2=1}))}else $chatrooms_button.hasClass("chat_tabclick")||($chatrooms_button.addClass("chat_tab_new_message"),a("<div/>").css("top","-11px").css("left",c_width_chatroom-10+"px").addClass("chat_tabalert").html(t).appendTo($chatrooms_button))}function receiveAnnouncement(t){if(0==t.read&&""!=t.data){if(a("#chat_announcement").remove(),$body.append(chat.Templates.announcements_display(t)),a("#chat_warnings").length){var o=parseInt(a(window).height()-a("#chat_warnings").position().top);a("#chat_announcement").css("bottom",o+5+"px")}a("#chat_announcement .chat_announce_close").click(function(){a("#chat_announcement").remove(),a("#chat_warnings").length&&a("#chat_warnings").css("bottom","35px"),a.post(c_ac_path+"includes/json/send/send_settings.php",{announce:1},function(){})})}else a("#chat_announcement").remove()}function addNotification(t,o){a("<div/>").attr("id","chat_alert_"+t).attr("class","chat_notification_message_div").html(o).appendTo(a("#chat_notifications_content")),Q++}function notificationAlerts(t){a("#chat_optionsbutton .chat_tabalertnf").remove(),$optionsbutton.hasClass("chat_tabclick")||(a("#chat_notification_alert").length>0&&a("#chat_notification_alert").remove(),$body.append('<div id="chat_notification_alert"><div class="chat_notification_alert_content">'+t+'</div><div class="chat_notification_tip_pos"></div></div>'),a("#chat_notification_alert").css("right","auto").css("left",a("#chat_optionsbutton").offset().left-a("#chat_notification_alert").outerWidth()+a("#chat_optionsbutton").outerWidth()/2+18),a("#chat_notification_alert .chat_notifications_divider").hide(),setTimeout(function(){a("#chat_notification_alert").fadeOut("slow",function(){a("#chat_notification_alert").remove()})},7e3),$optionsbutton.addClass("chat_tab_new_message"),a("<div/>").css("top","-10px").css("left","8px").addClass("chat_tabalertnf").html(Q).prependTo($optionsbutton)),Q>0&&a("#chat_no_new_notifications").css("display","none")}function stripslashes(t){return t=t.replace(/\\'/g,"'"),t=t.replace(/\\"/g,'"'),t=t.replace(/\\0/g,"\x00"),t=t.replace(/\\\\/g,"\\")}function receiveMessage(t,o,e,s,c,_){if(ma=t,clearTimeout(dtit3),DTitChange(uc_name[o]),j==o&&""!=uc_name[o]&&null!=uc_name[o]){var i=a("#chat_tabcontenttext_"+o)[0].scrollHeight-a("#chat_tabcontenttext_"+o).scrollTop()-10,n=a("#chat_tabcontenttext_"+o).outerHeight(),h=uc_name[o];"offline"==uc_status[o]&&loadBuddyList(),f="",1==c?(fromname=u_name,fromid=u_id,f=" chat_self",avatar=u_avatar,tooltip=lang[90]):(DTitChange(uc_name[o]),fromname=h,fromid=o,avatar=uc_avatar[o],tooltip=fromname);var r=fromid;e=stripslashes(e),e=replaceURLWithHTMLLinks(e),a("#chat_message_"+t).length>0?a("#chat_message_"+t+" .chat_chatboxmessagecontent").html(e):(1!=c_show_full_name&&-1!=fromname.indexOf(" ")&&(fromname=fromname.slice(0,fromname.indexOf(" "))),a(".chat_tabcontenttext",$user_popups[o]).append('<div class="chat_chatboxmessage chat_clearfix'+f+'" id="chat_message_'+t+'" style="display:none">'+formatTimestamp(new Date(1e3*s))+'<div class="chat_chatboxmessagefrom"><div class="chat_disable_avatars_name">'+fromname+'</div><img alt="'+tooltip+'" class="chat_chatbox_avatar" src="'+avatar+'" /></div><div class="chat_chatboxmessage_wrapper"><div class="chat_chatboxmessagecontent">'+e+"</div></div></div>"),1==c_chat_animations&&1!=_?" chat_self"==f?a("#chat_message_"+t).show("slide",{direction:"right"}):a("#chat_message_"+t).show("slide",{direction:"left"}):a("#chat_message_"+t).show(),last_sent[o]=s,last_name[o]=r,last_id[o]=t,(1==c_disable_avatars||a("#chat_setting_names_only :input").is(":checked"))&&setAvatarVisibility(1)),n>=i||!$users[o].hasClass("chat_tabclick")?(a("#chat_tabcontenttext_"+o).scrollTop(5e4),a(".chat_image_message img").one("load",function(){setTimeout(function(){a("#chat_tabcontenttext_"+o).scrollTop(5e4)},500)}).each(function(){this.complete&&a(this).load()})):displayMessage("chat_chatbox_message_flyout_"+o,lang[134],"notice"),1!=c&&1!=_&&showDesktopNotification(o,e,t)}else e=stripslashes(e),addMessageToChatbox(o,e,c,_,t,0,s),""==j&&0&&activateUser(o)}function receiveTyping(t){"undefined"!=typeof $users[t]&&a(".chat_closebox_bottom_status",$users[t]).addClass("chat_typing")}function receiveNotTyping(t){"undefined"!=typeof $users[t]&&a(".chat_closebox_bottom_status",$users[t]).removeClass("chat_typing")}function pushCancelAll(){1==c_push_engine&&(push.unsubscribe({channel:"u"+u_id}),push.unsubscribe({channel:"chat"}),Ccr>0&&push.unsubscribe({channel:"chatroom"+Ccr}))}function pushSubscribe(){1==c_push_engine&&(push.subscribe({channel:"u"+u_id,callback:function(t){pushReceive(t)}}),push.subscribe({channel:"chat",callback:function(t){pushReceive(t)}}))}function pushReceive(t){if("announcement"in t&&receiveAnnouncement(t.announcement),"warning"in t&&receiveWarning(t.warning),"notification"in t){var o;addNotification(t.notification.alert_id,t.notification.markup),notificationAlerts(o)}"chatroommessage"in t&&"undefined"==typeof blockList[t.chatroommessage.userid]&&(addChatroomMessage(t.chatroommessage.id,t.chatroommessage.name,t.chatroommessage.message,t.chatroommessage.userid,t.chatroommessage.sent,t.chatroommessage.global,t.chatroommessage.mod,t.chatroommessage.admin),"Delete"!=t.chatroommessage.name&&1!=t.chatroommessage.global&&(chatroomAlerts(1),t.chatroommessage.userid!=u_id&&1==u_chatroom_sound&&!a(".chat_chatroom_message_input").is(":focus")&&playNewMessageSound())),"typing"in t&&receiveTyping(t.typing.id),"nottyping"in t&&receiveNotTyping(t.nottyping.id),"messages"in t&&(receiveMessage(t.messages.id,t.messages.from,t.messages.message,t.messages.sent,t.messages.self,t.messages.old),1!=t.messages.self&&1==u_sounds&&!a(".chat_textarea",$user_popups[t.messages.from]).is(":focus")&&playNewMessageSound(),showTimeAndTooltip(),K=1,D=E),"chatroomban"in t&&(Ccr=0,chatroomreceived=0,loadChatroomList(),displayMessage("chat_chatroom_message_flyout",t.error2,"error"))}function DTitChange(t){t=renderHTMLString(t),2!=dtit2?(document.title=lang[30]+" "+t+"!",dtit2=2):(document.title=dtit,dtit2=1),0==window_focus?dtit3=setTimeout(function(){DTitChange(t)},1e3):(document.title=dtit,clearTimeout(dtit3))}function changePushChannel(t,a){1==a?push.subscribe({channel:t,callback:function(t){pushReceive(t)}}):push.unsubscribe({channel:t})}function buildTrayButtons(){for(var t="",o="",e="",s=0;s<barLinks.length;s++){var c=barLinks[s];(""==c[6]||0==c[6])&&(c[6]=16),s==barLinks.length-1&&(e=" chat_right_border"),t+='<div id="chat_trayicon_'+s+'" class="chat_tray_button chat_bar_left'+e+'" style="width:'+c[6]+'px;"><div class="chat_inner_button"><img class="chat_tray_icon" src='+c_ac_path+"themes/"+u_theme+"/images/icons/"+c[0]+'><div class="chat_tray_name">'+c[7]+"</div></div></div>","_popup"==c[3]&&(o+='<div id="chat_trayicon_'+s+'_popup" class="chat_traypopup" style="display:none"><div class="chat_traytitle"><div class="chat_name">'+c[1]+'</div><div class="chat_minimizebox"></div><br clear="all"/></div><div class="chat_traycontent"><div class="chat_traycontenttext"><iframe allowtransparency="true" frameborder=0 width="'+c[4]+'" height="'+c[5]+'" id="chat_trayicon_'+s+'_iframe"  ></iframe></div></div></div>')}$base.append("<div>"+t+"</div>"),$body.append("<div>"+o+"</div>"),a(".chat_tray_button").mouseover(function(){var t=a(this).attr("id").substr(14);(barLinks[t][6]<=16||""==barLinks[t][6])&&showTooltip(a("#chat_trayicon_"+t),barLinks[t][1],1),a(this).addClass("chat_tabmouseover")}),a(".chat_tray_button").mouseout(function(){a(this).removeClass("chat_tabmouseover"),hideTooltip()}),a(".chat_traytitle").mouseenter(function(){var t=a(this).parent().attr("id");t=t.substring(19,t.length-6),a(this).addClass("chat_chatboxtabtitlemouseover")}),a(".chat_traytitle").mouseleave(function(){var t=a(this).parent().attr("id");t=t.substring(19,t.length-6),a(this).removeClass("chat_chatboxtabtitlemouseover")}),a(".chat_traytitle").click(function(){var t=a(this).parent().attr("id");t=t.substring(19,t.length-6),a("#chat_trayicon_"+t).click()}),a(".chat_tray_button").click(function(){var t=a(this).attr("id").substr(14);""!=j&&(closePopup($user_popups[j],$users[j]),a(".chat_closebox_bottom",$users[j]).removeClass("chat_closebox_bottom_click"),j=""),closePopup($userstab_popup,$buddy_list_tab),closePopup($optionsbutton_popup,$optionsbutton),closePopup($modbutton_popup,$modbutton);var o="_self";if(barLinks[t][3]&&(o=barLinks[t][3]),"_popup"==o)m!=t&&(closePopup(a("#chat_trayicon_"+m+"_popup"),a("#chat_trayicon_"+m)),m=""),""==m?(a("#chat_trayicon_"+t+"_popup").css("left",a("#chat_trayicon_"+t).offset().left).css("bottom","25px").css("width",barLinks[t][4]),a("#chat_trayicon_"+t+"_popup").addClass("chat_tabopen"),a("#chat_trayicon_"+t).addClass("chat_trayclick"),(void 0===a("#chat_trayicon_"+t+"_iframe").attr("src")||""==a("#chat_trayicon_"+t+"_iframe").attr("src"))&&a("#chat_trayicon_"+t+"_iframe").attr("src",barLinks[t][2]),m=t):(closePopup(a("#chat_trayicon_"+m+"_popup"),a("#chat_trayicon_"+m)),m="");else{var e=barLinks[t][2].replace("{USER_ID}",u_id);e=e.replace("{USER_NAME}",u_name),window.open(e,o)}})}function buildChatboxes(){$chatbox_left.click(function(){0==$chatboxes.scrollLeft()||scrollChatboxes("-=148px")}),$chatbox_right.click(function(){$chatboxes.scrollLeft()+$chatboxes.width()==$chatboxes_wide.width()||scrollChatboxes("+=148px")})}function notificationPermission(){if(window.webkitNotifications&&window.webkitNotifications.checkPermission)window.webkitNotifications.requestPermission();else{if(!window.Notification||!window.Notification.requestPermission)return;window.Notification.requestPermission()}}function showDesktopNotification(t,a,o){var e=a.replace(/<(?:.|\n)*?>/gm,"").replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"');if(""!=e&&window.Notification&&!window_focus&&1==c_desktop_notify){var s=((new Date).getTime(),new window.Notification(lang[144]+renderHTMLString(uc_name[t]),{icon:uc_avatar[t],body:e,tag:o}));setTimeout(function(){s.close()},5e3)}}function lsClick(id,action,acvar){if(0==lsreceive){var milliseconds=(new Date).getTime();"ac_openclose"==action?"undefined"==typeof acvar?a(id).hasClass("chat_tabclick")?localStorage.setItem("ac_close",id+"/"+milliseconds):localStorage.setItem("ac_open",id+"/"+milliseconds):(eval("var temp=$"+acvar+";")," "==id?temp.hasClass("chat_tabclick")?localStorage.setItem("ac_close",id+","+acvar+"/"+milliseconds):localStorage.setItem("ac_open",id+","+acvar+"/"+milliseconds):a(id,acvar).hasClass("chat_tabclick")?localStorage.setItem("ac_close",id+","+acvar+"/"+milliseconds):localStorage.setItem("ac_open",id+","+acvar+"/"+milliseconds)):msieversion()||("undefined"==typeof acvar?localStorage.setItem(action,id+"/"+milliseconds):localStorage.setItem(action,id+","+acvar+"/"+milliseconds))}}function msieversion(){var t=window.navigator.userAgent,a=t.indexOf("MSIE ");return a>0||navigator.userAgent.match(/Trident.*rv\:11\./)?!0:!1}function localStorageFired(e){if(lsreceive=1,"ac_open"==e.key||"ac_close"==e.key||"ac_click"==e.key){var res=e.newValue.split("/"),res2=res[0].split(",");"undefined"==typeof res2[1]?"ac_click"==e.key?a(res2[0]).click():a(res2[0]).hasClass("chat_tabclick")||"ac_open"!=e.key?a(res2[0]).hasClass("chat_tabclick")&&"ac_close"==e.key&&a(res2[0]).click():a(res2[0]).click():(eval("var temp=$"+res2[1]+";")," "==res2[0]?"undefined"!=typeof temp&&"ac_click"==e.key?temp.click():"undefined"==typeof temp||temp.hasClass("chat_tabclick")||"ac_open"!=e.key?"undefined"!=typeof temp&&temp.hasClass("chat_tabclick")&&"ac_close"==e.key&&temp.click():temp.click():a(res2[0],temp).length&&"ac_click"==e.key?a(res2[0],temp).click():a(res2[0],temp).length&&!a(res2[0],temp).hasClass("chat_tabclick")&&"ac_open"==e.key?a(res2[0],temp).click():a(res2[0],temp).length&&a(res2[0],temp).hasClass("chat_tabclick")&&"ac_close"==e.key&&a(res2[0],temp).click())}lsreceive=0}function runchat(){if($base=a("<div/>").attr("id","chat_base").appendTo($body),window.addEventListener("storage",localStorageFired,!1),0!=c_chat_maintenance||0!=c_guests_login_msg&&""==u_id?buildMaintenance():(0!=c_hide_bar_on&&(buildShowBarButton(),buildHideBarButton()),buildPopoutChatButton(),1==u_is_mod&&1==c_enable_moderation&&buildModButton(),0!=c_notifications&&buildOptionsButton(),0!=c_chatrooms&&buildChatroomsButton(),buildBuddyListTab()),0==c_online_list&&a("#chat_buddy_list_tab").hide(),1!=c_links_right&&buildTrayButtons(),0!=c_applications_on&&(""==u_id&&"1"==c_guests_apps||""!=u_id&&1!=u_is_guest||""!=u_id&&1==u_is_guest&&1==c_guests_apps)&&(1!=c_no_apps_menu&&buildApplicationsButton(),buildApplicationButtons()),1==c_links_right&&buildTrayButtons(),$body.append('<div id="chat_sound_player_holder"></div>'),$chatbox_right=a("<div/>").attr("id","chat_chatbox_right").appendTo($base),a("<span/>").addClass("chat_next_tab").appendTo($chatbox_right),a("<div/>").addClass("chat_tabtext").appendTo($chatbox_right),a("<span/>").css("top","-5px").css("display","none").addClass("chat_tabalertlr").appendTo($chatbox_right),$chatboxes=a("<div/>").attr("id","chat_chatboxes").appendTo($base),$chatboxes_wide=a("<div/>").attr("id","chat_chatboxes_wide").appendTo($chatboxes),$chatbox_left=a("<div/>").attr("id","chat_chatbox_left").appendTo($base),a("<span/>").addClass("chat_previous_tab").appendTo($chatbox_left),a("<div/>").addClass("chat_tabtext").appendTo($chatbox_left),a("<span/>").css("top","-5px").css("display","none").addClass("chat_tabalertlr").appendTo($chatbox_left),buildChatboxes(),updateRightLastClasses(),$chatboxes_wide.css("width","0px"),addHover(a("#chat_chatbox_left, #chat_chatbox_right"),"chat_chatbox_lr_mouseover"),a(window).bind("resize",adjustBarSize),set("buddylist","1"),
set("initialize","1"),set("currenttime",ab),a(window).focus(function(){window_focus=!0}).blur(function(){window_focus=!1}),1==c_desktop_notify&&a("#chat_base").click(notificationPermission),"undefined"==typeof document.body.style.maxHeight&&(W=!0,$base.css("position","absolute"),$tooltip.css("position","absolute"),$userstab_popup.css("position","absolute"),$optionsbutton_popup.css("position","absolute"),a(window).bind("scroll",function(){positionchat()})),1==c_push_engine&&(push=PUBNUB.init({publish_key:c_push_publish,subscribe_key:c_push_subscribe})),1!=c_chat_maintenance)for(var t=0;t<unfocus_chat.length;t++)"-1"==unfocus_chat[t].toString().search("facebook")&&receiveUser(unfocus_chat[t],uc_name[unfocus_chat[t]],uc_status[unfocus_chat[t]],uc_avatar[unfocus_chat[t]],uc_link[unfocus_chat[t]],"1");1==u_hide_bar||"offline"==u_status?("offline"==u_status&&1!=u_hide_bar?(a("#chat_userstab_text").html("Chat (Offline)"),$chatboxes.hide(),$chatbox_right.hide(),$chatbox_left.hide()):($base.hide(),$show_bar_button.css("display","block")),w=1,a.idleTimer("destroy")):1!=c_chat_maintenance&&""!=u_id&&"1"!=u_popout_time?("-1"==u_chat_open.toString().search("facebook")&&0!=u_chat_open&&receiveUser(u_chat_open,uc_name[u_chat_open],uc_status[u_chat_open],uc_avatar[u_chat_open],uc_link[u_chat_open]),1==c_push_engine&&pushSubscribe(),receiveCore(),a("#chat_userslist_available").html('<div class="chat_nofriends"><div class="chat_loading_icon"></div>'+lang[25]+"</div>"),a(".chat_chatroom_full_content").html('<div class="chat_nofriends"><div class="chat_loading_icon"></div>'+lang[34]+"</div>"),1==u_blist_open&&0!=c_online_list?$buddy_list_tab.click():loadBuddyList(),-1!=u_chatroom_open&&void 0!==$chatrooms_button&&(0==u_chatroom_open&&$chatrooms_button.click(),0!=u_chatroom_open&&(Ccr=u_chatroom_open,chatroomreceived=1,"undefined"!=typeof $chatroom_create&&$chatroom_create.hide(),closePopup($userstab_popup,$buddy_list_tab),closePopup($optionsbutton_popup,$optionsbutton),closePopup($modbutton_popup,$modbutton),$chatrooms_popup.css("left",$chatrooms_button.offset().left-$chatrooms_popup.outerWidth()+$chatrooms_button.outerWidth()).css("bottom","25px"),$chatrooms_button.toggleClass("chat_tabclick").toggleClass("chat_userstabclick"),$chatrooms_popup.toggleClass("chat_tabopen"),loadChatroom(u_chatroom_open,crt[u_chatroom_open]))),u_chatroom_stay>0&&(Ccr=u_chatroom_stay,chatroomreceived=1,"undefined"!=typeof $chatroom_create&&$chatroom_create.hide(),loadChatroom(u_chatroom_stay,crt[u_chatroom_stay])),0==u_chatroom_stay&&-1==u_chatroom_open&&0!=c_chatroom_auto_join&&(Ccr=c_chatroom_auto_join,chatroomreceived=1,"undefined"!=typeof $chatroom_create&&$chatroom_create.hide(),loadChatroom(c_chatroom_auto_join,crt[c_chatroom_auto_join])),""!=u_apps_open&&"0"!=u_apps_open&&a("#chat_app_link_"+u_apps_open).click()):"1"==u_popout_time&&(a.idleTimer("destroy"),$buddy_list_tab.hide(),$popout_chat_button.show(),$chatboxes.hide(),$chatbox_right.hide(),$chatbox_left.hide()),clearUserStatus(),adjustBarSize(),a("#chat_userstab_icon").addClass("chat_user_"+u_status+"2")}function positionchat(){$base.css("top",a(window).scrollTop()+a(window).height()-25),$userstab_popup.css("top",parseInt(a(window).height())-parseInt($userstab_popup.css("bottom"))-parseInt($userstab_popup.height())+a(window).scrollTop()+"px"),$optionsbutton_popup.css("top",parseInt(a(window).height())-parseInt($optionsbutton_popup.css("bottom"))-parseInt($optionsbutton_popup.height())+a(window).scrollTop()+"px"),$tooltip.length>0&&$tooltip.css("top",parseInt(a(window).height())-parseInt($tooltip.css("bottom"))-parseInt($tooltip.height())+a(window).scrollTop()+"px"),""!=j&&($user_popups[j].css("position","absolute"),$user_popups[j].css("top",parseInt(a(window).height())-parseInt($user_popups[j].css("bottom"))-parseInt($user_popups[j].height())+a(window).scrollTop()+"px"))}function playNewMessageSound(){swfobject.embedSWF(c_ac_path+"themes/"+u_theme+"/sounds/new%5Fmessage.player.swf?soundswf="+c_ac_path+"themes/"+u_theme+"/sounds/new%5Fmessage.swf&autoplay=1&loops=0","chat_sound_player_holder","1","1","9.0.0")}function renderHTMLString(t){var o=t;if("undefined"!=typeof t){var e=a("<div/>").attr("id","chat_render").html(t).appendTo("body");o=a("#chat_render").html(),e.remove()}return o}var $body=a("body"),$base,$maintenance,$show_bar_button,$popout_chat_button,$optionsbutton,$optionsbutton_popup,$modbutton,$modbutton_popup,$chatrooms_button,$buddy_list_tab,$userstab_popup,$tooltip=null,$tooltip_content,$chatroom_chat,$chatroom_room_list,$chatrooms_popup,$chatroom_create,$chatroom_create_flyout,$application_buttons={},$application_button_popups={},$applications_button,$applications_button_popup,$applications_button_popups,$users=[],$user_popups=[],$chatbox_right,$chatboxes,$chatboxes_wide,$chatbox_left,$chatroom_admin_controls="",exp=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi;RegExp.escape=function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};var bounce2=1,bounce3=1,lsreceive=0,chatroom_mod=0,chatroom_admin=0,count=0,V={},dtit=document.title,dtit2=1,dtit3=1,window_focus=!0,xa={},j="",crou="",$=0,w=0,bli=1,isAway=0,chatroomreceived=0,W=!1,Y,Z,E=3e3,Crref2,Ccr=-1,open_report=-1,message_timeout,D=E,K=1,ma=0,R=0,m="",Ka=0,crt={},crt2={},y={},G={},aa={},ca={},last_id={},last_sent={},last_name={},history_ids={},room_info=[],room_desc=[],room_limit_msg=[],room_limit_sec=[],Aa=new Date,Na=Aa.getDate(),ab=Math.floor(Aa.getTime()/1e3),acsi=1,Q=0,fa=-1,acp="Powered By <a href='http://www.chat.com/' target='_blank'>chat</a>",pa=0,B,push,jabberListTimer,facebookResponse,jabber_hash="",session_var="",jabberInitialize=0,jabberInitialize2=0,jabberMsgTimer,onlineNumber=0,jabberOnlineNumber=0,errorCount=0,N,_ts="",_ts2;for(d=0;d<Themes.length;d++)_ts2=Themes[d][2]==u_theme?"selected":"",_ts=_ts+'<option value="'+Themes[d][0]+'" '+_ts2+">"+Themes[d][1]+"</option>";a.ajaxSetup({scriptCharset:"utf-8",cache:!1}),a.expr[":"].icontains=function(t,a,o){return(t.textContent||t.innerText||jqac(t).text()||"").toLowerCase().indexOf(o[3].toLowerCase())>=0},arguments.callee.videoWith=function(t){var a=window.open(c_ac_path+"public/video/?rid="+t,"audiovideochat","status=no,toolbar=no,menubar=no,directories=no,resizable=no,location=no,scrollbars=no,width="+c_video_width+",height="+c_video_height);a.focus()},arguments.callee.runchat=runchat,arguments.callee.chatroom=function(t){1==u_hide_bar&&showBar(),$chatrooms_button.click(),setTimeout(function(){Ccr=t,loadChatroom(t,"1")},400),$chatrooms_popup.addClass("chat_tabopen"),a("#chat_chatrooms_button").addClass("chat_tabclick").addClass("chat_userstabclick")},arguments.callee.chatWith=function(t){1==u_hide_bar&&showBar(),receiveUser(t,uc_name[t],uc_status[t],uc_avatar[t],uc_link[t])},arguments.callee.openCloseApp=function(t){a(".chat_appname_"+t).click()},arguments.callee.changeAppImage=function(t,o){a(".chat_appname_"+t+" img").attr("src",c_ac_path+o)},arguments.callee.addAppAlert=function(t,o){a(".chat_appname_"+t+" .chat_tabalert").length>0&&o>0?(a(".chat_appname_"+t+" .chat_tabalert").html(o),a(".chat_appname_"+t+" .chat_tabalert").effect("bounce",{times:3,distance:5},200)):a(".chat_appname_"+t).hasClass("chat_trayclick")||a("<div/>").css("top","-11px").css("left","6px").addClass("chat_tabalert").html(o).appendTo(".chat_appname_"+t)},arguments.callee.getUser=function(t,o){a.ajax({url:c_ac_path+"includes/json/receive/receive_user.php",data:{userid:t},type:"post",cache:!1,dataType:"json",success:function(t){t?window[o](t):window[o](0)}})},arguments.callee.sendMessage=function(t,o){""!=o&&a.post(c_ac_path+"includes/json/send/send_message.php",{to:t,message:o},function(e){e&&("-1"==e?displayMessage("chat_chatbox_message_flyout_"+t,lang[102],"error"):addMessageToChatbox(t,o,1,1,e,1,1),a(".chat_tabcontenttext",$user_popups[t]).scrollTop(a(".chat_tabcontenttext",$user_popups[t])[0].scrollHeight)),K=1})},arguments.callee.getBaseUrl=function(){return k},arguments.callee.logout=function(){clearTimeout(Z),clearTimeout(Crref2),a.idleTimer("destroy"),pushCancelAll(),cancelJSONP(),c_guests_login_msg=1,u_id="",closePopup($userstab_popup,$buddy_list_tab),closePopup($optionsbutton_popup,$optionsbutton),closePopup($modbutton_popup,$modbutton),closePopup($chatrooms_popup,$chatrooms_button),closePopup($applications_button_popup,$applications_button),""!=m&&(closePopup($application_button_popups[m],$application_buttons[m]),m=""),""!=j&&(closePopup($user_popups[j],$users[j]),a(".chat_closebox_bottom",$users[j]).removeClass("chat_closebox_bottom_click"),j=""),a("#chat_chatbox_right").remove(),a("#chat_chatbox_left").remove(),a("#chat_chatboxes").remove(),a("#chat_buddy_list_tab").remove(),a("#chat_chatrooms_button").remove(),a("#chat_optionsbutton").remove(),a("#chat_modbutton").remove(),a("#chat_hide_bar_button").remove(),buildMaintenance()}}}(jqac),jqac(document).ready(function(){1!=u_logged_in&&1!=c_disable_chat&&(jqac.chat(),jqac.chat.runchat())});